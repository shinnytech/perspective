var eo=Object.create;var Fe=Object.defineProperty;var to=Object.getOwnPropertyDescriptor;var ro=Object.getOwnPropertyNames;var no=Object.getPrototypeOf,oo=Object.prototype.hasOwnProperty;var Wt=e=>Fe(e,"__esModule",{value:!0});var Ut=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Oe=(e,t)=>{Wt(e);for(var r in t)Fe(e,r,{get:t[r],enumerable:!0})},ao=(e,t,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of ro(t))!oo.call(e,o)&&o!=="default"&&Fe(e,o,{get:()=>t[o],enumerable:!(r=to(t,o))||r.enumerable});return e},Yt=e=>ao(Wt(Fe(e!=null?eo(no(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);var ur=Ut((ps,cr)=>{cr.exports.default={types:{float:{filter_operator:"==",aggregate:"sum",format:{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}},string:{filter_operator:"==",aggregate:"count"},integer:{filter_operator:"==",aggregate:"sum",format:{}},boolean:{filter_operator:"==",aggregate:"count"},datetime:{filter_operator:"==",aggregate:"count",format:{week:"numeric",year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"},null_value:-1},date:{filter_operator:"==",aggregate:"count",format:{week:"numeric",year:"numeric",month:"numeric",day:"numeric"},null_value:-1}}}});var Ct=Ut((fs,Q)=>{var mr=ur().default;Q.exports.get_types=function(){return Object.keys(Q.exports.get_config().types)};Q.exports.get_type_config=function(e){let t={};if(Q.exports.get_config().types[e]&&Object.assign(t,Q.exports.get_config().types[e]),t.type){let r=Q.exports.get_type_config(t.type);return Object.assign(r,t),r}else return t};function Vt(e){return e&&typeof e=="object"&&!Array.isArray(e)}function Be(e,...t){if(!t.length)return e;let r=t.shift();if(Vt(e)&&Vt(r))for(let o in r)Vt(r[o])?(e[o]||Object.assign(e,{[o]:{}}),Be(e[o],r[o])):Object.assign(e,{[o]:r[o]});return Be(e,...t)}globalThis.__PERSPECTIVE_CONFIG__=void 0;Q.exports.override_config=function(e){globalThis.__PERSPECTIVE_CONFIG__&&console.warn("Config already initialized!"),globalThis.__PERSPECTIVE_CONFIG__=Be(mr,e)};Q.exports.get_config=function(){return globalThis.__PERSPECTIVE_CONFIG__||(globalThis.__PERSPECTIVE_CONFIG__=Be(mr,globalThis.__TEMPLATE_CONFIG__||{})),globalThis.__PERSPECTIVE_CONFIG__}});Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector);Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector);Element.prototype.closest||(Element.prototype.closest=function(e){var t=this;do{if(t.matches(e))return t;t=t.parentElement||t.parentNode}while(t!==null&&t.nodeType===1);return null});import{seriesSvgMulti as Ia}from"d3fc";import{axisBottom as Bo,axisLeft as $o,axisRight as Ho,axisTop as Io}from"d3fc";var A={none:"none",ordinal:"ordinal",time:"time",linear:"linear"},be=e=>{let t="crossValues",r=null,o=null,n=()=>{let a=l=>{let i=r?e[t].filter(s=>r==s.name):e[t];return t=="crossValues"&&i.length>1?!1:i.some(s=>l.includes(s.type))};return e[t].length===0?A.none:o!=A.time&&a(["datetime","date"])?A.time:o!=A.linear&&a(["integer","float"])||o==A.ordinal?A.linear:A.ordinal};return n.settingName=(...a)=>a.length?(t=a[0],n):t,n.settingValue=(...a)=>a.length?(r=a[0],n):r,n.excludeType=(...a)=>a.length?(o=a[0],n):o,n};var mt={};Oe(mt,{domain:()=>uo,labelFunction:()=>ut,scale:()=>co});import{scaleBand as mo}from"d3";var Kt=e=>{let t=r=>(o,n)=>o===void 0?n:n===void 0?o:r(o,n);return e.reduce((r,o)=>[t(Math.min)(r[0],o[0]),t(Math.max)(r[1],o[1])],[void 0,void 0])},re=e=>Array.isArray(e)?e.flat(1/0):[e];import{rebindAll as lo}from"d3fc";var io=1,Ne=e=>{let t=r=>e(r);return lo(t,e),t.bandwidth=(...r)=>r.length?(e.bandwidth(...r),t):Math.max(e.bandwidth(),io),t};import{rebindAll as so}from"d3fc";var Zt=e=>{let t=r=>e(r);return so(t,e),t.ticks=function(){return[]},t};var co=()=>Zt(Ne(mo())),uo=()=>{let e=["crossValue"],t="horizontal",r=n=>{let a=re(n);return o([...new Set(a.map(l=>l[e[0]]))])},o=n=>t=="vertical"?n.reverse():n;return r.valueName=(...n)=>n.length?(e=[n[0]],r):e[0],r.valueNames=(...n)=>n.length?(e=n[0],r):e,r.orient=(...n)=>n.length?(t=n[0],r):t,r},ut=e=>t=>t[e].join("|");var xt={};Oe(xt,{domain:()=>gt,labelFunction:()=>yt,scale:()=>fo,tickFormatFunction:()=>ho});import{scaleLinear as go}from"d3";import{rebindAll as yo}from"d3fc";import{max as ft,min as pt}from"d3-array";var Me=()=>{let e=[0,0],t="percent",r=o=>{switch(t){case"domain":{o[0]-=e[0],o[1]+=e[1];break}case"percent":{let n=o[1]-o[0];o[0]-=e[0]*n,o[1]+=e[1]*n;break}default:throw new Error("Unknown padUnit: "+t)}return o};return r.pad=function(){return arguments.length?(e=arguments.length<=0?void 0:arguments[0],r):e},r.padUnit=function(){return arguments.length?(t=arguments.length<=0?void 0:arguments[0],r):t},r};var Xt=function(){let e=[function(a){return a}],t=null,r=[],o=Me(),n=function(l){let i=new Array(l.length),s=!0,c=!1,m,p=e[Symbol.iterator]();try{for(let d;!(s=(d=p.next()).done);s=!0){let f=d.value;for(let h=0;h<l.length;h++){let g=f(l[h],h);Array.isArray(g)?i.push.apply(i,dt(g)):i.push(g)}}}catch(d){c=!0,m=d}finally{try{!s&&p.return&&p.return()}finally{if(c)throw m}}let u=[pt(i),ft(i)];if(u[0]=u[0]==null?pt(r):pt([u[0]].concat(dt(r))),u[1]=u[1]==null?ft(r):ft([u[1]].concat(dt(r))),t!=null){let d=Math.max(Math.abs(u[1]-t),Math.abs(u[0]-t));u[0]=t-d,u[1]=t+d}return o(u)};return n.accessors=function(){return arguments.length?(e=arguments.length<=0?void 0:arguments[0],n):e},n.pad=function(){return arguments.length?(o.pad(arguments.length<=0?void 0:arguments[0]),n):o.pad},n.padUnit=function(){return arguments.length?(o.padUnit(arguments.length<=0?void 0:arguments[0]),n):o.padUnit},n.include=function(){return arguments.length?(r=arguments.length<=0?void 0:arguments[0],n):r},n.symmetricalAbout=function(){return arguments.length?(t=arguments.length<=0?void 0:arguments[0],n):t},n.paddingStrategy=function(){return arguments.length?(o=arguments.length<=0?void 0:arguments[0],n):o},n},dt=function(e){if(Array.isArray(e)){let t=Array(e.length);for(let r=0;r<e.length;r++)t[r]=e[r];return t}else return Array.from(e)};import{format as ht}from"d3";var po=1e7,Re=e=>Math.abs(e)>=po?ht(".3s")(e):Number.isInteger(e)?ht(",.0f")(e):ht(",.2f")(e);var fo=()=>go(),gt=()=>{let e=Xt().pad([0,.1]).padUnit("percent"),t=["crossValue"],r=a=>(e.accessors(t.map(l=>i=>parseFloat(i[l]))),n(re(a)));yo(r,e);let o=a=>{let l=t.map(i=>a.map(s=>s[i]).sort((s,c)=>s-c).filter((s,c,m)=>c===0||s!==m[c-1]).reduce((s,c,m,p)=>m===0||s<=c-p[m-1]?s:Math.abs(c-p[m-1])));return Math.min(...l)},n=a=>{if(e.padUnit()=="domain"){let l=o(a);return e.pad([l/2,l/2])(a)}else return e(a)};return r.valueName=(...a)=>a.length?(t=[a[0]],r):t[0],r.valueNames=(...a)=>a.length?(t=a[0],r):t,r},yt=e=>t=>t[e][0],ho=Re;var vt={};Oe(vt,{domain:()=>bo,labelFunction:()=>bt,scale:()=>xo});import{scaleTime as vo}from"d3";import{exclude as _o,extentTime as wo,rebindAll as So}from"d3fc";var xo=()=>vo(),bo=()=>{let e=wo(),t=["crossValue"],r=a=>(e.accessors(t.map(l=>i=>new Date(i[l]))),n(re(a)));So(r,e,_o("include","paddingStrategy"));let o=a=>{let l=t.map(i=>a.map(s=>new Date(s[i]).getTime()).sort((s,c)=>s-c).filter((s,c,m)=>c===0||s!==m[c-1]).reduce((s,c,m,p)=>m===0||Math.abs(s)<=Math.abs(c-p[m-1])?Math.abs(s):Math.abs(c-p[m-1])));return Math.min(...l)},n=a=>{let l=Math.abs(o(a));return e.padUnit("domain").pad([l/2,l/2])(a)};return r.valueName=(...a)=>a.length?(t=[a[0]],r):t[0],r.valueNames=(...a)=>a.length?(t=a[0],r):t,r},bt=e=>t=>new Date(t[e][0]);var St={};Oe(St,{component:()=>Do,domain:()=>Eo,labelFunction:()=>wt,scale:()=>ko});import{scaleBand as Fo,select as ar}from"d3";import{axisOrdinalBottom as Oo,axisOrdinalLeft as No,axisOrdinalRight as Ro,axisOrdinalTop as Mo}from"d3fc";import{select as Jt,line as Vo}from"d3";import{axisOrdinalTop as Co,axisOrdinalBottom as Ao,axisOrdinalLeft as To,axisOrdinalRight as Lo,dataJoin as Qt,rebindAll as er,exclude as zo}from"d3fc";var qt=(...e)=>{let t={},r=o=>{for(let n of Object.keys(t))o[n](t[n]);return o};for(let o of e)r[o]=(...n)=>n.length?(t[o]=n[0],r):t[o];return r};var Pe=(e,t,r)=>{let o=6,n=6,a=qt("tickFormat","ticks","tickArguments","tickValues","tickPadding"),l=()=>{},i=null,s=Qt("g","group"),c=Qt("path","domain"),m=(h,g)=>u()?`translate(${g}, ${h})`:`translate(${h}, ${g})`,p=h=>u()?h.map(g=>[g[1],g[0]]):h,u=()=>e==="left"||e==="right",d=h=>{if(!i){a(t(r).decorate(l))(h);return}h.each((g,y,b)=>{let v=b[y],x=Jt(v),S=e==="bottom"||e==="right"?1:-1,_=r.range(),L=p([[_[0],S*o],[_[0],0],[_[1],0],[_[1],S*o]]);c(x,[g]).attr("d",Vo()(L)).attr("stroke","#000").attr("fill","none");let I=s(x,i),E=V=>Array.isArray(n)?n[V]:n,k=V=>{let C=0;for(let D=0;D<V;D++)C+=E(D);return C};I.attr("transform",(V,C)=>m(0,S*k(C))).each((V,C,D)=>{let U=Jt(D[C]),X=f(r,V);a(t(X)).decorate((q,te)=>l(q,te,C)).tickSizeInner(E(C)).tickOffset(q=>X.step(q)/2)(U),U.select("path.domain").attr("visibility","hidden")}),I.exit().attr("transform",(V,C)=>m(0,S*k(C)))})},f=(h,g)=>{function y(b){let v=b.domain;return v.reduce((x,S)=>x+h(S),0)/v.length}return y.ticks=()=>g,y.tickFormat=()=>b=>b.text,y.copy=()=>f(h,g),y.step=b=>b.domain.length*h.step(),er(y,h,zo("ticks","step","copy")),y};return d.tickSize=(...h)=>h.length?(n=o=Number(h[0]),d):n,d.tickSizeInner=(...h)=>h.length?(n=Array.isArray(h[0])?h[0]:Number(h[0]),d):n,d.tickSizeOuter=(...h)=>h.length?(o=Number(h[0]),d):o,d.decorate=(...h)=>h.length?(l=h[0],d):l,d.groups=(...h)=>h.length?(i=h[0],d):i,er(d,a),d},tr=e=>Pe("top",Co,e),rr=e=>Pe("bottom",Ao,e),nr=e=>Pe("left",To,e),or=e=>Pe("right",Lo,e);function ve(e){return e.getRootNode().host}function we(e){return e.closest("#container.chart")}var ko=()=>Ne(Fo()).padding(.5),Eo=()=>{let e=["crossValue"],t="horizontal",r=n=>{let a=re(n);return o([...Array.from(new Set(a.map(l=>l[e[0]])))])},o=n=>t=="vertical"?n.reverse():n;return r.valueName=(...n)=>n.length?(e=[n[0]],r):e[0],r.valueNames=(...n)=>n.length?(e=n[0],r):e,r.orient=(...n)=>n.length?(t=n[0],r):t,r},wt=e=>t=>t[e].join("|"),Do=e=>{let t="horizontal",r="crossValues",o=null,n=()=>{let u=e[r].length>1,d=l(o),f=d.map(i),h=u?f.map(x=>x.size):f[0].size,g=f.reduce((x,S)=>x+S.size,0),y=x=>S=>{let _=x(S);return u&&_.groups(d).tickSizeInner(h).tickSizeOuter(g),t!=="horizontal"&&_.tickPadding(10),_},b=(x,S,_)=>{let L=f[_].rotation;t==="horizontal"&&p(x,L),s(x,L)},v=a(u);return{bottom:y(v.bottom),left:y(v.left),right:y(v.right),top:y(v.top),size:`${g+10}px`,decorate:b}},a=u=>u?{bottom:rr,left:nr,top:tr,right:or}:{bottom:Oo,left:No,top:Mo,right:Ro},l=u=>{let d=[];return u.forEach(f=>{(f&&f.split?f.split("|"):[f]).forEach((g,y)=>{for(;d.length<=y;)d.push([]);let b=d[y];b.length>0&&b[b.length-1].text===g?b[b.length-1].domain.push(f):b.push({text:g,domain:[f]})})}),d.reverse()},i=u=>{let d=e.size.width,f=Math.max(...u.map(h=>h.text?h.text.length:0));return t==="horizontal"?u&&u.length*16>d-100?{size:f*5+10,rotation:90}:u&&u.length*(f*6+10)>d-100?{size:f*3+20,rotation:45}:{size:25,rotation:0}:{size:f*5+10,rotation:0}},s=(u,d)=>{let f=S=>{let _=S.indexOf(",")!==-1?",":" ",L=S.substring(S.indexOf("(")+1,S.indexOf(")")).split(_).map(P=>parseInt(P));for(;L.length<2;)L.push(0);return L},y=d?(S,_)=>S.x+S.width+14>_.x+_.width:(S,_)=>S.x<=_.x+_.width&&_.x<=S.x+S.width&&S.y<=_.y+_.height&&_.y<=S.y+S.height,b=(S,_)=>S.x>=_.x&&S.x+S.width<=_.x+_.width&&S.y>=_.y&&S.y+S.height<=_.y+_.height,v=t=="horizontal"?c(u):null,x=[];u.each((S,_,L)=>{let P=ar(L[_]),I=f(P.attr("transform")),E=P.node().getBBox(),k={x:E.x+I[0],y:E.y+I[1],width:E.width,height:E.height},C=x.some(D=>y(D,k))||v&&!b(k,v);P.attr("visibility",C?"hidden":""),C||x.push(k)})},c=u=>{let d=we(u.node());if(d===null)return;let f=d.querySelector(".cartesian-chart"),h=f.querySelector(".x-axis"),g=f.getBoundingClientRect(),y=h.getBoundingClientRect();return{x:g.left-y.left,width:g.width,y:g.top-y.top,height:g.height}},m=u=>u?u<60?`rotate(-${u} 5 5)`:`rotate(-${u} 3 7)`:"translate(0, 8)",p=(u,d)=>{let f=m(d),h=d?"end":"";u.each((g,y,b)=>{ar(b[y]).select("text").attr("transform",f).style("text-anchor",h)})};return n.orient=(...u)=>u.length?(t=u[0],n):t,n.settingName=(...u)=>u.length?(r=u[0],n):r,n.domain=(...u)=>u.length?(o=u[0],n):o,n};var Po={none:mt,ordinal:St,time:vt,linear:xt},T=e=>{let t=null,r="horizontal",o="crossValues",n=null,a=["crossValue"],l=["include","paddingStrategy","pad"],i={},s=p=>{let u=be(e).excludeType(t).settingName(o).settingValue(n)(),d=Po[u],f=d.domain().valueNames(a);l.forEach(y=>{i[y]&&f[y]&&f[y](i[y])}),f.orient&&f.orient(r);let h=f(p),g=d.component?c(d,h,p):m();return{scale:d.scale(),domain:h,domainFunction:f,labelFunction:d.labelFunction,component:{bottom:g.bottom,left:g.left,top:g.top,right:g.right},size:g.size,decorate:g.decorate,label:e[o].map(y=>y.name).join(", "),tickFormatFunction:d.tickFormatFunction}},c=(p,u,d)=>p.component(e).orient(r).settingName(o).domain(u)(d),m=()=>({bottom:Bo,left:$o,top:Io,right:Ho,decorate:()=>{}});return s.excludeType=(...p)=>p.length?(t=p[0],s):t,s.orient=(...p)=>p.length?(r=p[0],s):r,s.settingName=(...p)=>p.length?(o=p[0],s):o,s.settingValue=(...p)=>p.length?(n=p[0],s):n,s.valueName=(...p)=>p.length?(a=[p[0]],s):a[0],s.valueNames=(...p)=>p.length?(a=p[0],s):a,l.forEach(p=>{s[p]=(...u)=>u.length?(i[p]=u[0],s):i[p]}),s};import{select as Te,selectAll as Wo}from"d3";import{chartCartesian as Go,dataJoin as ir,seriesSvgPoint as jo}from"d3fc";var j=(e,t)=>lr(e,t,(r,o)=>r.svgPlotArea(o),!1),Se=(e,t)=>lr(e,t,(r,o)=>r.canvasPlotArea(o).svgPlotArea(jo()),!0),lr=(e,t,r,o)=>{let n=null,a=null,l=Go({xScale:e.scale,yScale:t.scale,xAxis:e.component,yAxis:t.component}).xDomain(e.domain).xLabel(e.label).xAxisHeight(e.size).xDecorate(e.decorate).xTickFormat(e.tickFormatFunction).yDomain(t.domain).yLabel(t.label).yAxisWidth(t.size).yDecorate(t.decorate).yOrient("left").yTickFormat(t.tickFormatFunction);e.decorate&&l.xDecorate(e.decorate),t.decorate&&l.yDecorate(t.decorate),l.xPaddingInner&&l.xPaddingInner(1),l.xPaddingOuter&&l.xPaddingOuter(.5),l.yPaddingInner&&l.yPaddingInner(1),l.yPaddingOuter&&l.yPaddingOuter(.5),l.axisSplitter=(...s)=>s.length?(n=s[0],l):n,l.altAxis=(...s)=>s.length?(a=s[0],l):a,l.plotArea=function(...s){return s.length==0?o?this.canvasPlotArea():this.svgPlotArea():r(this,...s)};let i=l.decorate();return l.decorate((s,c)=>{let m=s.select("d3fc-svg.plot-area"),p=m.select("svg").node();p.setAttribute("viewBox",`0 0 ${m.node().clientWidth} ${m.node().clientHeight}`),p.setAttribute("preserveAspectRatio","none");for(let u of["x-axis","y-axis"])s.select(`d3fc-svg.${u} svg`).node().setAttribute("preserveAspectRatio","none");if(i(s,c),o){let u=s.select(".svg-plot-area").node(),d=s.select(".canvas-plot-area").node();Wo([u,d]).order()}if(!!n){if(n.haveSplit()){let u=n.altData(),d=ir("d3fc-svg","y2-axis").key(y=>y),f=ir("g","y-series").key(y=>y);s.append("div").attr("class","y-label right-label").style("grid-column",5).style("-ms-grid-column",5).style("grid-row",3).style("-ms-grid-row",3).style("width",a.size||"1em").style("display","flex").style("align-items","center").style("justify-content","center").append("span").attr("class","y-label splitter-label").style("transform","rotate(-90deg)");let h=a.scale.domain(a.domain),g=a.component.right(h);if(g.tickFormat(a.tickFormatFunction),a.decorate&&g.decorate(a.decorate),d(s,["right"]).attr("class",y=>`y-axis ${y}-axis`).on("measure",function(y,b){let{width:v,height:x}=y.detail;b==="left"&&Te(y.currentTarget).select("svg").attr("viewBox",`${-v} 0 ${v} ${x}`).attr("preserveAspectRatio","none"),h.range([x,0])}).on("draw",function(y,b){Te(y.currentTarget).select("svg").call(g)}),o){let y=b=>{let v=l.plotArea();v.context(b.node().getContext("2d")).xScale(e.scale);let x=[t.scale,h];[c,u].forEach((S,_)=>{v.yScale(x[_]),v(S)})};s.select("d3fc-canvas.plot-area").on("draw",function(b,v){y(Te(b.currentTarget).select("canvas"))})}else{let y=function(b){let v=l.plotArea();v.xScale(e.scale);let x=[t.scale,h];f(b,[c,u]).each((S,_,L)=>{v.yScale(x[_]),Te(L[_]).datum(S).call(v)})};s.select("d3fc-svg.plot-area").on("draw",function(b,v){y(Te(b.currentTarget).select("svg"))})}}n(s)}}),l};import{autoBandwidth as ra,rebindAll as na,seriesSvgBar as yr,seriesSvgGrouped as ta}from"d3fc";import{select as Tt}from"d3";function F(e,t,r){let o=e.select(t);return o.size()>0?o:r()}function Y(e,t,r="right"){if(r==="right"||r==="bottom")return e[r]<t[r];if(r==="left"||r==="top")return e[r]>t[r];throw`Direction being checked for overflow is invalid: ${r}`}function _t(e,t,r,o=0){let n=e==="x"?"width":"height",a=t[e],l=t[e]+t[n],i=r[e],s=r[e]+r[n],c=i+o>a&&i-o<l,m=s+o>a&&s-o<l,p=i+o<a&&s-o>l;return c||m||p}var sr=`<ul id="tooltip-values"></ul>
`;import{select as Yo}from"d3";var dr=Yt(Ct());function _e(e,t){switch(e){case"date":case"datetime":return t instanceof Date?t:new Date(parseInt(t)).toLocaleString("en-us",(0,dr.get_type_config)(e).format);case"integer":return parseInt(t,10);case"float":return parseFloat(t)}return t}function $e(e,t){return t.crossValues.length===0?[]:e.crossValue.length===0?[]:((e.crossValue.split?e.crossValue.split("|"):[e.crossValue])||[e.key]).map((o,n)=>({name:t.crossValues[n].name,value:_e(t.crossValues[n].type,o)}))}function Ie(e,t){if(t.splitValues.length===0)return[];let r=e.key?e.key.split("|"):e.mainValue.split?e.mainValue.split("|"):[e.mainValue];return t.splitValues.map((o,n)=>({name:o.name,value:_e(o.type,r[n])}))}function He(e,t){return t.mainValues.length>1?e.mainValue?[{name:e.key,value:e.mainValue-(e.baseValue||0)}]:t.mainValues.map((r,o)=>({name:r.name,value:_e(r.type,e.mainValues[o])})):[{name:t.mainValues[0].name,value:_e(t.mainValues[0].type,e.colorValue||e.mainValue-e.baseValue||e.mainValue||e.mainValues)}]}var At=Yt(Ct());function pr(e,t,r){let o=$e(t,r).concat(Ie(t,r)).concat(He(t,r));Ko(e,o)}function Ko(e,t){e.select("#tooltip-values").selectAll("li").data(t).join("li").each(function(r){Yo(this).text(`${r.name}: `).append("b").text(Zo(r.value))})}var Zo=e=>e===null?"-":e.toLocaleString(void 0,{style:"decimal",minimumFractionDigits:(0,At.get_type_config)("float").precision,maximumFractionDigits:(0,At.get_type_config)("float").precision});var fr=e=>[e.name,"==",e.value],Le=(e,t,r)=>{let o=He(t,r).map(i=>i.name),n=$e(t,r).map(fr),a=Ie(t,r).map(fr),l=r.filter.concat(n).concat(a);e.dispatchEvent(new CustomEvent("perspective-click",{bubbles:!0,composed:!0,detail:{column_names:o,config:{filter:l},row:t.row}}))},hr=()=>{let e=null,t=r=>{let o=r.node();r.on("click",(n,a)=>Le(o,a,e))};return t.settings=(...r)=>r.length?(e=r[0],t):e,t};var ne=()=>{let e=!1,t=null,r=null,o=!1,n=a=>{let l=a.node();if(!l||!l.isConnected){gr(t);return}let i=Tt(we(l));t=Xo(i);let s=function(m,p){pr(t,p,r);let u=a.nodes(),d=u.indexOf(this);qo(i.node(),u[d],t,o),Tt(u[d]).style("opacity","0.7")},c=function(m,p){gr(t);let u=a.nodes(),d=u.indexOf(this);u&&Tt(u[d]).style("opacity","1")};e?a.each(function(m){return s.call(this,void 0,m)}):(a.on("mouseover",s).on("mouseout",c),hr().settings(r)(a))};return n.alwaysShow=(...a)=>a.length?(e=a[0],n):e,n.centered=(...a)=>a.length?(o=a[0],n):o,n.settings=(...a)=>a.length?(r=a[0],n):r,n};function Xo(e){return F(e,"div.tooltip",()=>e.append("div").attr("class","tooltip").style("z-index",3).style("opacity",0).html(sr))}function qo(e,t,r,o){let n=e.getBoundingClientRect(),a=t.getBoundingClientRect(),l=a.left+a.width/2-n.left,i=a.top-n.top+e.scrollTop;o&&(i=a.top+a.height/2-n.top+e.scrollTop),r.style("left",`${l}px`).style("top",`${i}px`).style("opacity",.9),o&&([l,i]=Jo(r,n)),Qo(r,n,l,i,o)}function Jo(e,t){let r=e.node().getBoundingClientRect(),o=r.width/2,n=r.left-o-t.left;e.style("left",`${n}px`);let a=r.height/2,l=r.top-a-t.top;return e.style("top",`${l}px`),[n,l]}function Qo(e,t,r,o,n=!1){let a=e.node().getBoundingClientRect();if(Y(t,a)){let l=a.right-t.right;e.style("left",`${r-l}px`)}if(Y(t,a,"bottom")){let l=a.bottom-t.bottom;e.style("top",`${o-l}px`)}if(!!n){if(Y(t,a,"left")){let l=a.left-t.left;e.style("left",`${r-l}px`)}if(Y(t,a,"top")){let l=a.top-t.top;e.style("top",`${o-l}px`)}}}function gr(e){e&&e.style("opacity",0)}function je(e,t){let r=e.mainValues.length>1?ta(yr()):yr();return r=r.decorate(o=>{ne().settings(e)(o),o.style("fill",n=>t(n.key))}),ra(ea(r)).crossValue(o=>o.crossValue).mainValue(o=>o.mainValue?o.mainValue:0).baseValue(o=>o.baseValue)}var ea=e=>{let t=r=>e(r);return na(t,e),t.bandwidth=(...r)=>r.length?(e.bandwidth(Math.max(r[0],1)),t):e.bandwidth(),t};import{color as aa,scaleOrdinal as oa}from"d3";function oe(e){return e.split("|").slice(0,-1).join("|")}function K(e){let t=e.data&&e.data.length>0?e.data[0]:{},r=Object.keys(t).filter(o=>o!=="__ROW_PATH__");return ae().settings(e).domain(r)()}function Ge(e,t){let r=Array.from(new Set(t));return ae().settings(e).domain(r)()}function We(e){let t=e.data&&e.data.length>0?e.data[0]:{},r=[];return Object.keys(t).forEach(o=>{if(o!=="__ROW_PATH__"){let n=oe(o);r.includes(n)||r.push(n)}}),ae().settings(e).domain(r)()}function ae(){let e=null,t=null,r={},o=a=>de(a,r.colorStyles&&r.colorStyles.opacity),n=()=>{let a=r.colorStyles,l=t||[a.series];if(l||e.length>1){let i=e.length>1?a.scheme:l;return oa(i.map(o)).domain(e)}return null};return n.domain=(...a)=>a.length?(e=a[0],n):e,n.defaultColors=(...a)=>a.length?(t=a[0],n):t,n.mapFunction=(...a)=>a.length?(o=a[0],n):o,n.settings=(...a)=>a.length?(r=a[0],n):r,n}function Z(e){return pe(1)(e)}function de(e,t=.5){return pe(t)(e)}function pe(e){return t=>{let r=aa(t);return r.opacity=e,r+""}}import{rebindAll as la}from"d3fc";var ia={none:ut,ordinal:wt,time:bt,linear:yt},G=e=>{let t=be(e),r="__ROW_PATH__",o=(n,a)=>ia[t()](r)(n,a);return la(o,t),o.valueName=(...n)=>n.length?(r=n[0],o):r,o};function fe(e,t,{stack:r=!1,excludeEmpty:o=!1}={}){let n=t||e.data;return e.splitValues.length>0?sa(e,n,{stack:r,excludeEmpty:o}):[n]}function sa(e,t,{stack:r=!1,excludeEmpty:o=!1}){let n={};return t.forEach(a=>{let l={},i={};Object.keys(a).filter(s=>s!=="__ROW_PATH__").filter(s=>!o||a[s]!=null&&a[s]!=null).forEach(s=>{let c=s.split("|"),m=c[c.length-1],p=a[s]||0,u=`${m}${p>=0?"+ve":"-ve"}`,d=c.slice(0,c.length-1).join("|"),f=i[d]=i[d]||{__ROW_PATH__:a.__ROW_PATH__},h=l[u]||0;f.__KEY__=d,r?(f[m]=h+p,f[`__BASE_VALUE__${m}`]=h,l[u]=f[m]):f[m]=p,f.row=a}),Object.keys(i).forEach(s=>{(n[s]=n[s]||[]).push(i[s])})}),Object.keys(n).map(a=>{let l=n[a];return l.key=a,l})}function xr(e,t){let r={stack:!1},o=fe(e,t,r).map(n=>br(e,n,r));return e.mainValues.length>1?o.reduce((a,l)=>a.concat(l)):o}function Ue(e,t){let r={stack:!0};return fe(e,t,r).map(o=>br(e,o,r))}function ca(e,t,{stack:r=!1}){let o=G(e);return n=>{let a=i=>r&&i[`__BASE_VALUE__${n.name}`]||0,l=t.map((i,s)=>({crossValue:o(i,s),mainValue:i[n.name]?i[n.name]:null,baseValue:a(i),key:i.__KEY__?`${i.__KEY__}|${n.name}`:n.name,row:i.row||i}));return l.key=l[0].key,l}}function br(e,t,{stack:r=!1}){let o=ca(e,t,{stack:r});return e.mainValues.length>1?e.mainValues.map(o):o(e.mainValues[0])}import{scaleOrdinal as za,symbol as La}from"d3";import{legendColor as Aa,legendSymbol as Ta}from"d3-svg-legend";import{legendColor as Va}from"d3-svg-legend";import{rebindAll as _a}from"d3fc";var vr=`<span id="up-arrow">&#9650;</span>
<span id="page-text"></span>
<span id="down-arrow">&#9660;</span>
`;function wr(e){let t=e.select("g.legendCells"),r=e.node().getBoundingClientRect();if(!Y(r,t.node().getBoundingClientRect()))return;let o=e.select(".legend");t.selectAll(".label").text((n,a,l)=>{let i=l[a];if(Y(r,i.getBoundingClientRect())){let s=ma(i,o,r);return`${n.substring(0,s-3)}...`}else return n})}function ma(e,t,r){let o=e.getBoundingClientRect(),n=t.node().createSVGPoint(),a=3;return n.x=r.right-o.left-a,n.y=0,e.getCharNumAtPosition(n)}import{drag as ga,select as Ye}from"d3";import{select as da}from"d3";var he=10;function le(e,t,r){let o=da(ve(e).getContainer()).node().getBoundingClientRect(),n=e.getBoundingClientRect(),a={top:n.top+r-he,right:n.right+t+he,bottom:n.bottom+r+he,left:n.left+t-he},l={x:t,y:r};return[{edge:"right",dimension:"x"},{edge:"left",dimension:"x"},{edge:"top",dimension:"y"},{edge:"bottom",dimension:"y"}].forEach(s=>{if(Y(o,a,s.edge)){let c=a[s.edge]-o[s.edge];l[s.dimension]=l[s.dimension]-c}}),l}var Lt="resize.for-dragging";function Sr(){let e=!0,t=null,r=o=>{let n=o.node(),a=n.getRootNode().host.closest("perspective-viewer");n.style.cursor="move",t.legend&&(n.style.left=t.legend.left,n.style.top=t.legend.top);let l=ga().on("drag",function(i){let s=le(this,i.dx,i.dy);this.style.left=`${this.offsetLeft+s.x}px`,this.style.top=`${this.offsetTop+s.y}px`;let c={left:this.style.left,top:this.style.top};t.legend={...t.legend,...c},e=ha(n)?fa(n):pa(n,e)});l.on("end",function(i){Ye(window).on(Lt,null),a?.dispatchEvent(new Event("perspective-config-update"))}),o.call(l)};return r.settings=(...o)=>o.length?(t=o[0],r):t,r}function pa(e,t){return t!==!1&&Ye(window).on(Lt,function(){let r=le(e,0,0);e.style.left=`${e.offsetLeft+r.x}px`,e.style.top=`${e.offsetTop+r.y}px`}),!1}function fa(e){return Ye(window).on(Lt,null),e.style.left="auto",!0}function ha(e){let t=e.getBoundingClientRect(),r=Ye(we(e)).node().getBoundingClientRect(),o=5;return t.right+he+o>=r.right&&t.top-he-o<=r.top}import{drag as Lr,select as Sa}from"d3";var _r="horizontal-drag-handle",Vr="vertical-drag-handle",ya="corner-drag-handle",Cr="dragHandles",Ar=0,ie="resize";function Tr(){let e=9,t=3,r=null,o={height:100,width:100},n={height:null,width:null},a=[],l=(m,p)=>a.filter(u=>u.event===m).forEach(u=>u.execute(p)),i=m=>{if(ba(m))return;let p={left:w=>l(ie,{horizontal:U(w),vertical:!1}),top:w=>l(ie,{horizontal:!1,vertical:me(w)}),right:w=>l(ie,{horizontal:X(w),vertical:!1}),bottom:w=>l(ie,{horizontal:!1,vertical:q(w)}),topleft:w=>l(ie,{horizontal:U(w),vertical:me(w)}),topright:w=>l(ie,{horizontal:X(w),vertical:me(w)}),bottomright:w=>l(ie,{horizontal:X(w),vertical:q(w)}),bottomleft:w=>l(ie,{horizontal:U(w),vertical:q(w)})},u=m.node();r.legend&&(u.style.height=r.legend.height,u.style.width=r.legend.width);let d=u.getBoundingClientRect(),f=m.append("svg").attr("id",Cr).attr("width",d.width).attr("height",d.height),h=f.append("g"),g=w=>w==="left"||w==="right",y={left:0,top:e,right:d.width-e,bottom:e},b={left:e,top:0,right:e,bottom:d.height-e},v=["left","top","right","bottom"],[x,S,_,L]=v.map(w=>h.append("rect").attr("id",`drag${w}`).attr("class",g(w)?Vr:_r).attr("y",b[w]).attr("x",y[w]).attr("height",g(w)?d.height-e*2:e).attr("width",g(w)?e:d.width-e*2).attr("fill",g(w)?"lightgreen":"lightblue").attr("fill-opacity",Ar).style("z-index",t).attr("cursor",g(w)?"ew-resize":"ns-resize").call(Lr().on("drag",p[w]))),P=w=>`${w[0]}${w[1]}`,I={topleft:"nwse",topright:"nesw",bottomright:"nwse",bottomleft:"nesw"},E=[["top","left"],["top","right"],["bottom","right"],["bottom","left"]],[k,V,C,D]=E.map(w=>h.append("rect").attr("id",`drag${P(w)}`).attr("class",`${ya} ${w[0]} ${w[1]}`).attr("height",e).attr("width",e).attr("fill","red").attr("fill-opacity",Ar).style("z-index",t).attr("cursor",`${I[P(w)]}-resize`).call(Lr().on("drag",p[P(w)])));Gt("height","y",L),Gt("width","x",_),jt(f);function U(w){let z=c(le(x.node(),w.x,0).x,f,"width",(H,J)=>H-J);return u.style.left=`${u.offsetLeft+z}px`,u.style.width=`${u.offsetWidth-z}px`,te(),Ae(_,z,"width","x")}function X(w){let z=-c(le(_.node(),w.dx,0).x,f,"width",(H,J)=>H+J);return s(z,"x",_,w)?!1:(u.style.width=`${u.offsetWidth-z}px`,te(),Ae(_,z,"width","x"))}function me(w){let z=c(le(S.node(),0,w.y).y,f,"height",(H,J)=>H-J);return u.style.top=`${u.offsetTop+z}px`,u.style.height=`${u.offsetHeight-z}px`,te(),Ae(L,z,"height","y")}function q(w){let z=-c(le(L.node(),0,w.dy).y,f,"height",(H,J)=>H+J);return s(z,"y",L,w)?!1:(u.style.height=`${u.offsetHeight-z}px`,te(),Ae(L,z,"height","y"))}function te(){let w={top:u.style.top,left:u.style.left,height:u.style.height,width:u.style.width};r.legend={...r.legend,...w}}function Ae(w,z,H,J){return wa(f,H,z),va(w,J,z),xa(f,z,H,H==="height"?Vr:_r),jt(f),z!=0}function jt(w){k.attr("y",0,"x",0),V.attr("y",0).attr("x",w.attr("width")-e),C.attr("y",w.attr("height")-e).attr("x",w.attr("width")-e),D.attr("y",w.attr("height")-e).attr("x",0)}function Gt(w,z,H){!!n[w]&&n[w]<d[w]&&(u.style[w]=`${n[w]}px`,Ae(H,d[w]-n[w],w,z))}};i.on=(m,p)=>(a.push({event:m,execute:p}),i),i.zIndex=m=>(t=m,i),i.settings=(...m)=>m.length?(r=m[0],i):r,i.minWidth=m=>(o.width=m,n.width&&(n.width=Math.max(o.width,n.width)),i),i.minHeight=m=>(o.height=m,n.height&&(n.height=Math.max(o.height,n.height)),i),i.handleWidth=m=>(e=m,i),i.maxWidth=m=>(n.width=m,o.width=Math.min(o.width,n.width),i),i.maxHeight=m=>(n.height=m,o.height=Math.min(o.height,n.height),i);function s(m,p,u,d){let f=(g,y,b,v)=>g<0&&v[y]<Number(b.attr(y)),h=(g,y,b,v)=>g>0&&v[y]>Number(b.attr(y));return f(m,p,u,d)||h(m,p,u,d)}function c(m,p,u,d){let f=d(Number(p.attr(u)),m);if(f<o[u]){let h=o[u]-f;return d(m,h)}if(!!n[u]&&f>n[u]){let h=n[u]-f;return d(m,h)}return m}return i}var xa=(e,t,r,o)=>{e.selectAll(`.${o}`).each((a,l,i)=>{let s=i[l];Sa(s).attr(r,s.getBoundingClientRect()[r]-t)})},ba=e=>e.select(`#${Cr}`).size()>0,va=(e,t,r)=>e.attr(t,Number(e.attr(t))-r),wa=(e,t,r)=>e.attr(t,e.node().getBoundingClientRect()[t]-r);var zr=16,kr=20,zt=(e,t)=>{let r=e||Va(),o=[],n=1,a,l=t.legend&&t.legend.pageIndex?t.legend.pageIndex:0,i=()=>{},s=Sr().settings(t),c,m=x=>{o=r.scale().domain(),c=Tr().settings(t).maxHeight(o.length*zr+kr).on("resize",()=>p(x)),c(x),s(x),p(x)},p=x=>{g(x),u(x),d(x),wr(x)},u=x=>{let S=b(x);S.style("display",n<=1?"none":"block"),S.select("#page-text").text(`${l+1}/${n}`),S.select("#up-arrow").attr("class",l===0?"disabled":"").on("click",()=>{l>0&&(f(l-1),p(x))}),S.select("#down-arrow").attr("class",l>=n-1?"disabled":"").on("click",()=>{l<n-1&&(f(l+1),p(x))})},d=x=>{n>1&&r.cellFilter(h()),x.select("g.legendCells").remove();let S=v(x);S.call(r);let _=x.select("g.legendCells").node().getBBox();S.attr("height",_.height+kr),i(x)},f=x=>{l=x,t.legend={...t.legend,pageIndex:l}},h=()=>(x,S)=>S>=a*l&&S<a*l+a,g=x=>{let S=x.node().getBoundingClientRect(),_=Math.floor(S.height/zr)-1;a=_<o.length?_-1:_,n=y(_),l=Math.min(l,n-1)},y=x=>Math.ceil(o.length/x),b=x=>F(x,".legend-controls",()=>x.append("g").attr("class","legend-controls").html(vr)),v=x=>F(x,".legend",()=>x.append("svg").attr("class","legend"));return m.decorate=(...x)=>x.length?(i=x[0],m):i,_a(m,r),m};var Er=e=>zt(Aa().shape("circle").shapeRadius(6),e),Ca=e=>zt(Ta().shapePadding(1).labelOffset(3),e),B=()=>kt(Er),Ke=()=>kt(Ca,Fr),Dr=()=>kt(Er,Fr);function Fr(e){if(!e)return null;let t=e.domain(),r=e.range().map(o=>La().type(o)());return za().domain(t).range(r)}function kt(e,t){let r={},o=null,n=null;function a(l){if(o&&o.range().length>1){let i=e(r);i.scale(o).orient("vertical").on("cellclick",function(c){let m=this.__data__;r.hideKeys=r.hideKeys||[],r.hideKeys.includes(m)?r.hideKeys=r.hideKeys.filter(p=>p!==m):r.hideKeys.push(m),ve(this)._draw()}),i.labels(c=>{let m=c.domain[c.i].split("|");return r.mainValues.length<=1&&m.length>1?m.slice(0,m.length-1).join("|"):c.domain[c.i]});let s=F(l,"div.legend-container",()=>l.append("div"));i.decorate(c=>{let m=u=>r.hideKeys&&r.hideKeys.includes(u),p=c.select("g.legendCells").attr("transform","translate(20,20)").selectAll("g.cell");p.classed("hidden",m),p.append("title").html(u=>u),n&&p.select("circle, path").style("fill",u=>m(u)?null:n(u)).style("stroke",u=>m(u)?null:Z(n(u)))}),s.attr("class","legend-container").attr("borderbox-on-hover",!0).style("z-index","2").call(i)}}return a.settings=(...l)=>l.length?(r=l[0],a):r,a.scale=(...l)=>l.length?(o=t?t(l[0]):l[0],a):o,a.color=(...l)=>l.length?(n=l[0],a):n,a}function W(e,t){let r=t||e.data;return e.hideKeys&&e.hideKeys.length>0?r.map(o=>{let n={...o};return e.hideKeys.forEach(a=>{delete n[a]}),n}):r}function Ve(e,t){let r=t||e.data;return e.hideKeys&&e.hideKeys.length>0?r.map(o=>{let n={};return Object.keys(o).map(a=>{e.hideKeys.includes(oe(a))||(n[a]=o[a])}),n}):r}import{annotationCanvasGridline as Ra,annotationSvgGridline as Na,seriesCanvasMulti as Ma,seriesSvgMulti as Oa}from"d3fc";var ka=e=>t=>t.style("stroke-width","1.0").style("stroke",e?e.colorStyles.grid.gridLineColor:"#bbb"),Ea=e=>t=>{t.strokeStyle=e?e.colorStyles.grid.gridLineColor:"#bbb",t.lineWidth=1},Da=e=>e.style("display","none"),Fa=e=>t=>{t.lineWidth=1,t.strokeStyle=e?e.colorStyles.grid.gridLineColor:"#bbb"},O=(e,t)=>{let r="both",o=!1,n=null,a=null,l=null,i=Oa(),s=Na(),c=ka(t),m=Da,p=function(...u){o&&(i=Ma().context(l),s=Ra(),c=Ea(t),m=Fa(t));let d=i.xScale(n).yScale(a),f=r==="vertical"?m:c,h=r==="horizontal"?m:c,g=s.xDecorate(f).yDecorate(h);return d.series([g,e])(...u)};return p.orient=(...u)=>u.length?(r=u[0],p):r,p.canvas=(...u)=>u.length?(o=u[0],p):o,p.xScale=(...u)=>u.length?(n=u[0],p):n,p.yScale=(...u)=>u.length?(a=u[0],p):a,p.context=(...u)=>u.length?(l=u[0],p):l,p};import{rebindAll as Pa}from"d3fc";var M=()=>{let e=Me(),t=r=>{let o=e.pad(),n=e.padUnit(),a=1;switch(n){case"domain":break;case"percent":{a=r[1]-r[0];break}default:throw new Error("Unknown padUnit: "+n)}let l=r[0]-o[0]*a,i=r[1]+o[1]*a;return r[0]=r[0]>=0&&l<0?0:l,r[1]=r[1]<=0&&i>0?0:i,r};return Pa(t,e),t};import{zoom as $a,zoomIdentity as Et}from"d3";var Or=`<button id="zoom-reset">Reset zoom</button>
<button id="one-year">1 Year</button>
<button id="six-months">6 Months</button>
<button id="one-month">1 Month</button>
`;var N=()=>{let e=null,t=null,r=null,o=null,n=null,a=null,l=!1,i=!1,s=()=>{};function c(d){let f=`d3fc-${i?"canvas":"svg"}.plot-area`;if(r||n){let h=o&&o.domain()[0]instanceof Date,g=$a().on("zoom",b=>{let{transform:v}=b;t.zoom={k:v.k,x:v.x,y:v.y},m(v),d.call(e);let x=v.k===1&&v.x===0&&v.y===0,S=p(d).style("display",x?"none":"");S.select("#zoom-reset").on("click",()=>d.select(f).call(g.transform,Et));let _=S.select("#one-year").style("display",h?"":"none"),L=S.select("#six-months").style("display",h?"":"none"),P=S.select("#one-month").style("display",h?"":"none");if(h){let I=E=>()=>{let k=new Date(r.domain()[0]),V=new Date(k);E(k,V);let C=o.range(),D=(C[1]-C[0])/(o(V)-o(k)),U=-o(k)*D,X=0;if(n){let me=n.domain().reduce((q,te)=>q+te)/2;X=-a(me)*D+n(me)}d.select(f).call(g.transform,Et.translate(U,X).scale(D))};_.on("click",I((E,k)=>k.setYear(E.getFullYear()+1))),L.on("click",I((E,k)=>k.setMonth(E.getMonth()+6))),P.on("click",I((E,k)=>k.setMonth(E.getMonth()+1)))}}),y=e.decorate();e.decorate((b,v)=>{if(y(b,v),!l){l=!0;let x=b.select(f),S=i?window.devicePixelRatio:1;x.on("measure.zoom-range",_=>{if(o&&o.range([0,_.detail.width/S]),a&&a.range([0,_.detail.height/S]),t.zoom){let L=Et.translate(t.zoom.x,t.zoom.y).scale(t.zoom.k);x.call(g.transform,L)}}).call(g)}})}d.call(e)}c.chart=(...d)=>d.length?(e=d[0],c):e,c.settings=(...d)=>d.length?(t=d[0],c):t,c.xScale=(...d)=>d.length?(r=u(d[0]),o=r?r.copy():null,c):r,c.yScale=(...d)=>{if(!d.length)return n;if(n=u(d[0]),a=n?n.copy():null,a){let f=a.domain();a.domain([f[1],f[0]])}return c},c.canvas=(...d)=>d.length?(i=d[0],c):i,c.onChange=(...d)=>d.length?(s=d[0],c):s;let m=d=>{let f={...d};if(r&&(r.domain(d.rescaleX(o).domain()),f.xDomain=r.domain()),n){let h=d.rescaleY(a).domain();n.domain([h[1],h[0]]),f.yDomain=n.domain()}s(f)},p=d=>F(d,".zoom-controls",()=>d.append("div").attr("class","zoom-controls").style("display","none").html(Or)),u=d=>d&&d.nice?d:null;return c};function Nr(e,t){let r=Ue(t,W(t)),o=K(t),n=B().settings(t).scale(o),a=je(t,o).orient("horizontal"),l=Ia().mapping((p,u)=>p[u]).series(r.map(()=>a)),i=T(t).settingName("mainValues").valueName("mainValue").excludeType(A.ordinal).include([0]).paddingStrategy(M())(r),s=T(t).excludeType(A.linear).settingName("crossValues").valueName("crossValue").orient("vertical")(r),c=j(i,s).plotArea(O(l,t).orient("horizontal"));c.yPaddingInner&&(c.yPaddingInner(.5),c.yPaddingOuter(.25),a.align("left")),c.xNice&&c.xNice();let m=N().chart(c).settings(t).yScale(s.scale);e.datum(r).call(m),e.call(n)}Nr.plugin={name:"X Bar",category:"X Chart",max_cells:1e3,max_columns:50,render_warning:!0};var Mr=Nr;import{seriesSvgMulti as Ga}from"d3fc";var Rr=(e,t)=>{if(!Pr(e)||!Pr(t))return;let r=Br(e),o=Br(t);r>o?t[0]=$r(t,r):e[0]=$r(e,o)},Pr=e=>e.length===2&&!isNaN(e[0])&&!isNaN(e[1])&&e[0]!==e[1],Br=e=>(0-e[0])/(e[1]-e[0]),$r=(e,t)=>t*e[1]/(t-1);import{dataJoin as Ha}from"d3fc";var Ir=e=>{let t=[],r=!1,o,n=l=>{l.text("");let i=Ha("span","splitter-label").key(m=>m),s=!r&&t.length===1,c=o&&e.splitValues.length===0;i(l,t).classed("disabled",s).text(m=>m.name).style("color",m=>c?Z(o(m.name)):void 0).on("click",(m,p)=>{s||(r?e.splitMainValues=e.splitMainValues.filter(u=>u!=p.name):e.splitMainValues=[p.name].concat(e.splitMainValues||[]),m.target.getRootNode().host.closest("perspective-viewer")?.dispatchEvent(new Event("perspective-config-update")),a(l))})},a=l=>{let i=ve(l.node());i._container.innerHTML="",i._draw()};return n.labels=(...l)=>l.length?(t=l[0],n):t,n.alt=(...l)=>l.length?(r=l[0],n):r,n.color=(...l)=>l.length?(o=l[0],n):o,n};var se=(e,t,r=ja)=>{let o,n,a,l=e.splitMainValues||[],i=m=>{let p=m.split("|");return l.includes(p[p.length-1])},s=e.mainValues.some(m=>i(m.name));n=s?r(t,m=>!i(m)):t,a=s?r(t,i):null;let c=m=>{if(e.mainValues.length===1)return;let p=e.mainValues.map((h,g)=>({index:g,name:h.name})),u=p.filter(h=>!i(h.name)),d=p.filter(h=>i(h.name)),f=()=>Ir(e).color(o);m.select(".y-label.left-label").call(f().labels(u)),m.select(".y-label.right-label").call(f().labels(d).alt(!0))};return c.color=(...m)=>m.length?(o=m[0],c):o,c.haveSplit=()=>s,c.data=(...m)=>m.length?(n=m[0],c):n,c.altData=(...m)=>m.length?(a=m[0],c):a,c},ja=(e,t)=>e.map(r=>r.filter(o=>t(o.key))),Dt=(e,t)=>e.map(r=>t(r.key)?r:r.map(o=>Object.assign({},o,{mainValue:null}))),Hr=(e,t)=>e.map(r=>Dt(r,t));function jr(e,t){let r=Ue(t,W(t)),o=K(t),n=B().settings(t).scale(o),a=je(t,o).orient("vertical"),l=Ga().mapping((h,g)=>h[g]).series(r.map(()=>a)),i=T(t).excludeType(A.linear).settingName("crossValues").valueName("crossValue")(r),s=T(t).settingName("mainValues").valueName("mainValue").excludeType(A.ordinal).orient("vertical").include([0]).paddingStrategy(M()),c=t.mainValues.length>1?Hr:Dt,m=se(t,r,c).color(o),p=s(m.data()),u=m.haveSplit()?l:O(l,t).orient("vertical"),d=j(i,p).axisSplitter(m).plotArea(u);d.xPaddingInner&&(d.xPaddingInner(.5),d.xPaddingOuter(.25),a.align("left")),d.yNice&&d.yNice();let f=N().chart(d).settings(t).xScale(i.scale);if(m.haveSplit()){let h=s(m.altData());Rr(p.domain,h.domain),d.yDomain(p.domain).altAxis(h)}e.datum(m.data()).call(f),e.call(n)}jr.plugin={name:"Y Bar",category:"Y Chart",max_cells:1e3,max_columns:50,render_warning:!0};var Gr=jr;import{seriesSvgRepeat as Ka}from"d3fc";import{seriesSvgLine as Wa}from"d3fc";function Ce(e,t){let r=Wa(),o=e.data.length*(e.data?.length>0?Object.keys(e.data[0]).length-(e.crossValues?.length>0?1:0):0),n=Math.max(1,Math.min(3,Math.floor(e.size.width/o/2)));return r=r.decorate(a=>{a.style("stroke",l=>Z(t(l[0]&&l[0].key))).style("stroke-width",n)}),r.crossValue(a=>a.crossValue).mainValue(a=>a.mainValue)}function Wr(e,t){let r=G(e);return t.map((o,n)=>Object.keys(o).filter(a=>a!=="__ROW_PATH__").map(a=>({key:a,crossValue:r(o,n),mainValue:o[a],row:o})))}var Ze=function(e){let t=[];for(let r of e)for(let o=0;o<r.length;o++)r[o].mainValue!==null&&(t[o]=t[o]||[],t[o].push(r[o]));return t};import{pointer as Ua,rebindAll as Ya}from"d3fc";var Ft=(e,t,r=Math.min)=>{let o=l=>l.reduce((i,s)=>{let c=n(s,t);return c&&(!i||r(i.value,c.value)===c.value)?c:i},null),n=l=>{if(Array.isArray(l))return o(l,t);let i=t(l);return i!==null?{item:l,value:i}:null},a=o(e,t);return a?a.item:null};var $=()=>{let e=ne().alwaysShow(!0),t=null,r=null,o=null,n=null,a=!1,l=null,i="crossValue",s="mainValue",c=null,m=1;function p(f){let h=`d3fc-${a?"canvas":"svg"}.plot-area`;if(t||r){let g=null,y=Ua().on("point",b=>{let v=b.length?d(b[0]):null;g=v?[v.data]:[];let x=v?v.scale:r;u(f,g,x)});f.select(h).on("measure.nearbyTip",()=>u(f,[])).on("click",()=>{g.length&&Le(f.node(),g[0],e.settings())}).call(y)}}let u=(f,h,g=r)=>{let y=f.select("d3fc-svg.plot-area svg").selectAll("circle.nearbyTip").data(h);y.exit().remove(),y.enter().append("circle").attr("class","nearbyTip").merge(y).attr("r",b=>n?m*Math.sqrt(n(b.size)):10).attr("transform",b=>`translate(${t(b[i])},${g(b[s])})`).style("stroke","none").style("fill",b=>o&&b.key&&de(o(b.key))),e(y)},d=f=>{let h=b=>v=>v[s]===void 0||v[s]===null||v[i]===void 0||v[i]===null?null:Math.sqrt(Math.pow(t(v[i])-f.x,2)+Math.pow(b(v[s])-f.y,2)),g=h(r),y=Ft(l,g,Math.min);if(c){let b=h(c.yScale),v=Ft(c.data,b,Math.min);return g(y)<=b(v)?{data:y,scale:r}:{data:v,scale:c.yScale}}return{data:y,scale:r}};return p.scaleFactor=(...f)=>f.length?(m=f[0],p):m,p.xScale=(...f)=>f.length?(t=f[0],p):t,p.yScale=(...f)=>f.length?(r=f[0],p):r,p.color=(...f)=>f.length?(o=f[0],p):o,p.size=(...f)=>f.length?(n=f[0]?f[0].copy().range([40,4e3]):null,p):n,p.canvas=(...f)=>f.length?(a=f[0],p):a,p.data=(...f)=>f.length?(l=f[0],p):l,p.xValueName=(...f)=>f.length?(i=f[0],p):i,p.yValueName=(...f)=>f.length?(s=f[0],p):s,p.altDataWithScale=(...f)=>f.length?(c=f[0],p):c,Ya(p,e),p};function Ur(e,t){let r=Wr(t,W(t)),o=K(t),n=B().settings(t).scale(o),a=Ka().series(Ce(t,o)).orient("horizontal"),l=M().pad([.1,.1]).padUnit("percent"),i=T(t).excludeType(A.linear).settingName("crossValues").valueName("crossValue")(r),s=T(t).settingName("mainValues").valueName("mainValue").orient("vertical").paddingStrategy(l),c=se(t,Ze(r)).color(o),m=s(c.data()),p=c.haveSplit()?a:O(a,t).orient("vertical"),u=j(i,m).axisSplitter(c).plotArea(p);u.yNice&&u.yNice();let d=N().chart(u).settings(t).xScale(i.scale),f=$().settings(t).xScale(i.scale).yScale(m.scale).color(o).data(r);if(c.haveSplit()){let g=s(c.altData());u.altAxis(g),f.data(c.data()).altDataWithScale({yScale:g.scale,data:c.altData()})}let h=c.data();e.datum(h).call(d),e.call(f),e.call(n)}Ur.plugin={name:"Y Line",category:"Y Chart",max_cells:4e3,max_columns:50,render_warning:!0};var Yr=Ur;import{seriesSvgRepeat as al}from"d3fc";import{seriesCanvasPoint as ol}from"d3fc";import{scaleOrdinal as nl,symbolCircle as Xa,symbolCross as qa,symbolDiamond as Ja,symbolSquare as Qa,symbolStar as el,symbolTriangle as tl,symbolWye as rl}from"d3";var Za=[Xa,qa,Ja,Qa,el,tl,rl];function Xe(e){return e.length>1?nl().domain(e).range(Za):null}function Kr(e,t,r,o,n,a=1){let l=ol().crossValue(i=>i.x).mainValue(i=>i.y);return r&&l.size(i=>Math.round(a*r(i.size))),n&&l.type(n(t)),l.decorate((i,s)=>{let c=o(s.colorValue!==void 0?s.colorValue:t),m=e.colorStyles&&e.colorStyles.opacity;i.strokeStyle=Z(c),i.fillStyle=de(c,m)}),l}function qe(e){let t=e.data&&e.data.length>0?e.data[0]:{},r=[];return Object.keys(t).forEach(o=>{if(o!=="__ROW_PATH__"){let n=oe(o);r.includes(n)||r.push(n)}}),Xe(r)}function Zr(e,t){let r=e.mainValues.length;return t.map(o=>{let n=Object.keys(o).filter(l=>l!=="__ROW_PATH__"),a=new Array(n.length/r);for(let l=0;l<n.length/r;l++)a[l]={key:oe(n[l*r]),crossValue:o[n[l*r]],mainValue:o[n[l*r+1]],row:o};return a})}function Xr(e,t){let r=Ze(Zr(t,Ve(t))),o=We(t),n=qe(t),a=null;o.domain().length>2&&(a=Dr().settings(t).scale(n).color(o));let l=al().series(Ce(t,o)).orient("horizontal"),i=M().pad([.1,.1]).padUnit("percent"),s=T(t).settingName("mainValues").settingValue(t.mainValues[0].name).valueName("crossValue").paddingStrategy(i),m=T(t).settingName("mainValues").settingValue(t.mainValues[1].name).valueName("mainValue").orient("vertical").paddingStrategy(i)(r),p=s(r),u=O(l,t).orient("vertical"),d=j(p,m).xLabel(t.mainValues[0].name).yLabel(t.mainValues[1].name).plotArea(u);d.xNice&&d.xNice(),d.yNice&&d.yNice();let f=N().chart(d).settings(t).xScale(p.scale).yScale(m.scale),h=$().settings(t).xScale(p.scale).yScale(m.scale).color(o).data(r);e.datum(r).call(f),e.call(h),a&&e.call(a)}Xr.plugin={name:"X/Y Line",category:"X/Y Chart",max_cells:5e4,max_columns:50,render_warning:!0,initial:{type:"number",count:2,names:["X Axis","Y Axis","Tooltip"]},selectMode:"toggle"};var qr=Xr;import{seriesSvgMulti as il,seriesSvgRepeat as rn}from"d3fc";import{seriesSvgArea as ll}from"d3fc";function Jr(e,t){let r=ll();return r=r.decorate(o=>{o.style("fill",n=>t(n[0].key)).style("opacity",.5)}),r.crossValue(o=>o.crossValue).mainValue(o=>o.mainValue).baseValue(o=>o.baseValue)}function Qr(e,t){let r=G(e);return t.map((o,n)=>{let a={};return Object.keys(o).filter(l=>l!=="__ROW_PATH__").map(l=>{let i=l.split("|"),s=i[i.length-1],c=a[s]||0,m=c+o[l];return a[s]=m,{key:l,crossValue:r(o,n),mainValue:m,baseValue:c,row:o}})})}function en(e,t){let r=Qr(t,W(t)),o=K(t),n=B().settings(t).scale(o),a=rn().series(Jr(t,o).orient("vertical")),l=rn().series(Ce(t,o)).orient("vertical"),i=il().series([a,l]),s=T(t).excludeType(A.linear).settingName("crossValues").valueName("crossValue")(r),c=T(t).settingName("mainValues").valueName("mainValue").excludeType(A.ordinal).orient("vertical").include([0]).paddingStrategy(M()),m=se(t,r).color(o),p=c(m.data()),u=m.haveSplit()?i:O(i,t).orient("vertical"),d=j(s,p).axisSplitter(m).plotArea(u);d.yNice&&d.yNice();let f=N().chart(d).settings(t).xScale(s.scale),h=$().settings(t).xScale(s.scale).yScale(p.scale).color(o).data(r);if(m.haveSplit()){let g=c(m.altData());d.altAxis(g),h.data(m.data()).altDataWithScale({yScale:g.scale,data:m.altData()})}e.datum(m.data()).call(f),e.call(h),e.call(n)}en.plugin={name:"Y Area",category:"Y Chart",max_cells:4e3,max_columns:50,render_warning:!0};var tn=en;import{seriesSvgMulti as cl}from"d3fc";import{seriesSvgPoint as sl}from"d3fc";function nn(e,t,r,o){let n=sl().size(100),a=e.colorStyles&&e.colorStyles.opacity;return o&&n.type(o(t)),n.decorate(l=>{l.style("stroke",i=>Z(r(i.colorValue||t))).style("fill",i=>de(r(i.colorValue||t),a))}),n.crossValue(l=>l.crossValue).mainValue(l=>l.mainValue)}function on(e){let t=e.data&&e.data.length>0?e.data[0]:{},r=Object.keys(t).filter(o=>o!=="__ROW_PATH__");return Xe(r)}function an(e,t){let r=xr(t,W(t)),o=on(t),n=K(t),a=Ke().settings(t).scale(o).color(n),l=cl().mapping((g,y)=>g[y]).series(r.map(g=>nn(t,g.key,n,o))),i=M().pad([.05,.05]).padUnit("percent"),s=T(t).excludeType(A.linear).settingName("crossValues").valueName("crossValue")(r),c=T(t).settingName("mainValues").valueName("mainValue").orient("vertical").paddingStrategy(i),m=se(t,r).color(n),p=c(m.data()),u=m.haveSplit()?l:O(l,t).orient("vertical"),d=j(s,p).axisSplitter(m).plotArea(u);d.yNice&&d.yNice();let f=N().chart(d).settings(t).xScale(s.scale),h=$().settings(t).xScale(s.scale).yScale(p.scale).color(n).data(r);if(m.haveSplit()){let g=c(m.altData());d.altAxis(g),h.data(m.data()).altDataWithScale({yScale:g.scale,data:m.altData()})}e.datum(m.data()).call(f),e.call(h),a&&e.call(a)}an.plugin={name:"Y Scatter",category:"Y Chart",max_cells:4e3,max_columns:50,render_warning:!0};var ln=an;import{seriesCanvasMulti as _l}from"d3fc";function sn(e,t){return fe(e,t,{excludeEmpty:!0}).map(r=>ul(e,r))}function ul(e,t){let r=G(e),o=t.map((n,a)=>({crossValue:r(n,a),mainValues:e.mainValues.map(l=>n[l.name]),x:n[e.mainValues[0].name],y:n[e.mainValues[1].name],colorValue:e.realValues[2]?n[e.realValues[2]]:void 0,size:e.realValues[3]?n[e.realValues[3]]:void 0,key:t.key,row:n}));return o.key=t.key,o}import{interpolate as fl,scaleLinear as dl,scaleSequential as pl}from"d3";function cn(e,t,r,o){return dl().domain(un(t,r,o))}function ce(e,t,r,o){let n=un(t,r,o),a=e.colorStyles.gradient.full;if(n[0]>=0)a=e.colorStyles.gradient.positive;else if(n[1]<=0)a=e.colorStyles.gradient.negative;else{let i=Math.max(-n[0],n[1]);n=[-i,i]}let l=ml(a);return pl(l).domain(n)}var un=(e,t,r)=>r||gt().valueName(t).pad([0,0])(e),ml=e=>{let t=e.slice(1).map((r,o)=>fl(e[o][1],r[1]));return r=>{let o=e.findIndex((i,s)=>s<e.length-1&&r<=e[s+1][0]&&r>i[0]);if(o===-1)return r<=e[0][0]?e[0][1]:e[e.length-1][1];let n=t[o],[a]=e[o],[l]=e[o+1];return n((r-a)/(l-a))}};import{range as yl,scaleBand as hl,scaleLinear as xl}from"d3";import{autoBandwidth as bl,axisRight as wl,extentLinear as gl,seriesSvgBar as vl}from"d3fc";function ue(){let e=null;function t(r){let o=F(r,"div.legend-container",()=>r.append("div").attr("class","legend-container legend-color").style("z-index","2")),{width:n,height:a}=o.node().getBoundingClientRect(),l=hl().domain([0,1]).range([0,n]),i=e.copy().nice().domain(),s=gl().pad([.1,.1]).padUnit("percent")(i),[c,m]=s,p=yl(c,m,(m-c)/a),u=xl().domain(s).range([a,0]),d=bl(vl()).xScale(l).yScale(u).crossValue(0).baseValue((x,S)=>p[Math.max(0,S-1)]).mainValue(x=>x).decorate(x=>{x.selectAll("path").style("fill",S=>e(S))}),f=i[0]<0&&i[1]>0?0:Math.round((i[1]+i[0])/2),h=[...i,f],g=wl(u).tickValues(h).tickSizeOuter(0).tickFormat(x=>Re(x)),y=F(o,"svg",()=>o.append("svg")).style("width",n).style("height",a),b=F(y,"g",()=>y.append("g")).datum(p).call(d),v=Math.abs(b.node().getBBox().x);F(y,"#legend-axis",()=>y.append("g").attr("id","legend-axis")).attr("transform",`translate(${v})`).datum(p).call(g).select(".domain").attr("visibility","hidden")}return t.scale=(...r)=>r.length?(e=r[0],t):e,t}function Sl([e,t],[r,o]){let n=(o-t)/(r-e),a=o-n*r;return function(l){let i=l.node(),s=Math.min(i.clientWidth,i.clientHeight);return Math.min(o,Math.max(t,n*s+a))}}function mn(e,t){let r=sn(t,Ve(t)),o=qe(t),n=t.realValues.length<=2||t.realValues[2]===null,a=null,l=null;n?(a=We(t),l=Ke().settings(t).scale(o).color(n?a:null)):(a=ce(t,r,"colorValue"),l=ue().scale(a));let i=t.realValues[3]?cn(t,r,"size").range([10,1e4]):null,s=Sl([600,.1],[1600,1])(e),c=_l().mapping((g,y)=>g[y]).series(r.map(g=>Kr(t,g.key,i,a,o,s))),m=()=>T(t).settingName("mainValues").paddingStrategy(M()).pad([.1,.1]),p=m().settingValue(t.mainValues[0].name).valueName("x")(r),u=m().orient("vertical").settingValue(t.mainValues[1].name).valueName("y")(r),d=Se(p,u).xLabel(t.mainValues[0].name).yLabel(t.mainValues[1].name).plotArea(O(c,t).canvas(!0));d.xNice&&d.xNice(),d.yNice&&d.yNice();let f=N().chart(d).settings(t).xScale(p.scale).yScale(u.scale).canvas(!0),h=$().scaleFactor(s).settings(t).canvas(!0).xScale(p.scale).xValueName("x").yValueName("y").yScale(u.scale).color(n&&a).size(i).data(r);e.datum(r).call(f),e.call(h),l&&e.call(l)}mn.plugin={name:"X/Y Scatter",category:"X/Y Chart",max_cells:5e4,max_columns:50,render_warning:!0,initial:{type:"number",count:2,names:["X Axis","Y Axis","Color","Size","Tooltip"]},selectMode:"toggle"};var dn=mn;import{autoBandwidth as Cl,seriesCanvasHeatmap as Vl}from"d3fc";function pn(e,t){let r=Vl();return r.decorate((o,n)=>{o.fillStyle=t(n.colorValue)}),Cl(r).xValue(o=>o.crossValue).yValue(o=>o.mainValue).colorValue(o=>o.colorValue).colorInterpolate(t.interpolator()).widthFraction(1)}function fn(e,t){let r=G(e),o=be(e).excludeType(A.linear).settingName("splitValues")(),n=[];return t.forEach((a,l)=>{let i=r(a,l);Object.keys(a).filter(s=>s!=="__ROW_PATH__").forEach(s=>{let c=Al(s);n.push({crossValue:i,mainValue:o===A.time?new Date(c):c,colorValue:a[s],row:a})})}),n}function Al(e){let t=e.split("|");return t.pop(),t.join("|")}function hn(e,t){let r=fn(t,W(t)),o=ce(t,r,"colorValue"),n=pn(t,o),a=ue().scale(o),l=T(t).excludeType(A.linear).settingName("crossValues").valueName("crossValue")(r),i=T(t).excludeType(A.linear).settingName("splitValues").valueName("mainValue").orient("vertical")(r),s=Se(l,i).plotArea(O(n,t).canvas(!0));s.xPaddingInner&&(s.xPaddingInner(0),s.xPaddingOuter(0),n.xAlign("right")),s.yPaddingInner&&(s.yPaddingInner(0),s.yPaddingOuter(0),n.yAlign("top"));let c=N().chart(s).settings(t).xScale(l.scale).yScale(i.scale).canvas(!0),m=$().settings(t).canvas(!0).xScale(l.scale).yScale(i.scale).color(o).data(r);e.datum(r).call(c),e.call(a),e.call(m)}hn.plugin={name:"Heatmap",category:"Hierarchial Chart",max_cells:5e4,max_columns:500,render_warning:!0};var gn=hn;import{seriesCanvasOhlc as Nl}from"d3fc";import{indicatorBollingerBands as Fl,seriesCanvasMulti as Ol}from"d3fc";function yn(e,t){return fe(e,t,{excludeEmpty:!0}).map(r=>Tl(e,r))}function Tl(e,t){let r=G(e),o=a=>t[a<t.length-1?a+1:a][e.mainValues[0].name],n=t.map((a,l)=>{let i=e.mainValues.length>=1?a[e.mainValues[0].name]:void 0,s=e.mainValues.length>=2?a[e.mainValues[1].name]:o(l);return{crossValue:r(a,l),mainValues:e.mainValues.map(c=>a[c.name]),openValue:i,closeValue:s,highValue:e.mainValues.length>=3?a[e.mainValues[2].name]:Math.max(i,s),lowValue:e.mainValues.length>=4?a[e.mainValues[3].name]:Math.min(i,s),key:t.key,row:a}});return n.key=t.key,n}import{seriesCanvasArea as kl,seriesCanvasLine as zl,seriesCanvasMulti as El}from"d3fc";var Ll=e=>e.closeValue>=e.openValue;function xn(e,t,r){let o=r.domain(),n=ae().domain(o).settings(e).defaultColors([e.colorStyles["series-2"]]).mapFunction(pe(.5))(),a=ae().settings(e).domain(o)(),l=t().crossValue(c=>c.crossValue).openValue(c=>c.openValue).highValue(c=>c.highValue).lowValue(c=>c.lowValue).closeValue(c=>c.closeValue).decorate((c,m)=>{let p=Ll(m)?r(m.key):n(m.key);c.fillStyle=p,c.strokeStyle=p}),i=zl().mainValue(c=>c.bollinger.average).crossValue(c=>c.crossValue).decorate((c,m)=>{c.strokeStyle=a(m[0].key)}),s=kl().mainValue(c=>c.bollinger.upper).baseValue(c=>c.bollinger.lower).crossValue(c=>c.crossValue).decorate((c,m)=>{c.fillStyle=pe(.25)(a(m[0].key))});return El().series([s,l,i])}function Dl(e){return function(t,r){let o=yn(r,Ve(r)),n=Fl().value(y=>y.openValue),a=o.map(y=>{let b=n(y);return y.map((v,x)=>Object.assign({bollinger:b[x]},v))}),l=o.map(y=>y.key).concat(r.hideKeys?r.hideKeys:[]).sort(),i=ae().domain(l).settings(r).mapFunction(pe(1))(),s=B().settings(r).scale(l.length>1?i:null),c=xn(r,e,i),m=Ol().mapping((y,b)=>y[b]).series(a.map(()=>c)),p=M().pad([.1,.1]).padUnit("percent"),u=T(r).settingName("crossValues").valueName("crossValue")(a),d=T(r).settingName("mainValues").valueNames(["lowValue","highValue"]).orient("vertical").paddingStrategy(p)(a),f=Se(u,d).plotArea(O(m,r).orient("vertical").canvas(!0));f.yNice&&f.yNice();let h=N().chart(f).settings(r).xScale(u.scale).onChange(y=>{let b=a.map(v=>v.filter(x=>x.crossValue>=y.xDomain[0]&&x.crossValue<=y.xDomain[1]));f.yDomain(d.domainFunction(b))}).canvas(!0),g=$().settings(r).xScale(u.scale).yScale(d.scale).yValueName("closeValue").color(i).data(a).canvas(!0);t.datum(a).call(h),t.call(g),t.call(s)}}var Je=Dl;var bn=Je(Nl);bn.plugin={name:"OHLC",category:"Y Chart",max_cells:3500,max_columns:50,render_warning:!0,initial:{type:"number",count:4,names:["Open","Close","High","Low"]},selectMode:"toggle"};var vn=bn;import{seriesCanvasCandlestick as Ml}from"d3fc";var wn=Je(Ml);wn.plugin={name:"Candlestick",category:"Y Chart",max_cells:4e3,max_columns:50,render_warning:!0,initial:{type:"number",count:4,names:["Open","Close","High","Low"]},selectMode:"toggle"};var Sn=wn;import{select as Ln}from"d3";function _n(e,t){if(e.realValues.length>1&&e.realValues[1]!==null){let r=e.realValues[1];if(e.mainValues.find(o=>o.name===r)?.type==="string"){let o=t.map(n=>n.data).filter(n=>n.height>0).map(n=>Vn(n)).reduce((n,a)=>n.concat(a));return Ge(e,o)}else return ce(e,null,null,Kt(t.map(o=>o.extents)))}}function Vn(e,t=[]){return e.children&&e.children.length>0?e.children.forEach(r=>t.concat(Vn(r,t))):e.data.color&&t.push(e.data.color),t}import{hierarchy as Bl,partition as $l}from"d3";function Qe(e){let t={},r=e.realValues.map(n=>n===null?null:e.mainValues.find(a=>a.name===n));return e.data.forEach((n,a)=>{let l=n.__ROW_PATH__;Pl(n).forEach(s=>{let c;t[s]||(t[s]=[]),c=t[s],l.forEach((m,p)=>{let u=c.find(d=>d.name===m);if(u||(u={name:m,children:[]},c.push(u)),e.realValues.length>1&&e.realValues[1]!==null){let d=p===l.length-1,f=ze(d?n:e.agg_paths[a][p+1]||n,e.mainValues[1],s);f!==void 0&&(u.color=f)}if(e.realValues.length>2&&e.realValues[2]!==null){u.tooltip=[];for(let d=2;d<e.realValues.length;++d)u.tooltip.push(ze(n,r[d],s))}if(p===l.length-1&&(u.name=l.slice(-1)[0],l.length===e.crossValues.length)){let d=ze(n,e.mainValues[0],s);u.size=d>0?d:0}c=u.children})})}),Object.entries(t).map(n=>{let a={name:"root",children:n[1]},l=Bl(a).sum(s=>s.size),i=$l().size([2*Math.PI,l.height+1])(l);return i.each(s=>{s.current=s,s.mainValues=e.realValues.length===1||e.realValues[1]===null&&e.realValues[2]===null?s.value:[s.value,s.data.color].concat(s.data.tooltip||[]).filter(c=>c!==void 0),s.crossValue=s.ancestors().slice(0,-1).reverse().map(c=>c.data.name),s.key=n[0],s.label=_e(e.crossValues[s.depth-1<0?0:s.depth-1].type,s.data.name)}),{split:n[0],data:i,extents:Rl(e,n)}})}var ze=(e,t,r)=>r.length?e[`${r}|${t.name}`]:e[t.name];function Rl(e,[t,r]){if(e.realValues.length>1&&e.realValues[1]!==null){let o=Math.min(...e.data.map(a=>ze(a,e.mainValues[1],t))),n=Math.max(...r.map(a=>a.color));return[o,n]}}function Pl(e){let t=[];return Object.keys(e).forEach(r=>{if(r!=="__ROW_PATH__"){let o=r.split("|").slice(0,-1).join("|");t.includes(o)||t.push(o)}}),t}import{arc as Il}from"d3";var et=e=>Il().startAngle(t=>t.x0).endAngle(t=>t.x1).padAngle(t=>Math.min((t.x1-t.x0)/2,.005)).padRadius(e).innerRadius(t=>Math.max(1,(t.y0-1)*e)).outerRadius(t=>Math.max((t.y0-1)*e,(t.y1-1)*e-1)),ee=e=>e.y0>=1&&e.x1>e.x0;import{select as Hl}from"d3";var ke=e=>e.y1<=3&&e.y0>=1&&(e.y1-e.y0)*(e.x1-e.x0)>.06;function tt(e,t){let r=(e.x0+e.x1)/2*180/Math.PI,o=(e.y0-1+(e.y1-1))/2*t;return`rotate(${r-90}) translate(${o},0) rotate(${r<180?0:180})`}function Cn(e,t){let r=this.getBBox().width;if(r>t){let o=e.label,n=Hl(this);for(;r>t;)o=o.substring(0,o.length-1),n.text(()=>o),r=this.getBBox().width;n.text(()=>`${o.substring(0,o.length-3).replace(/\s+$/,"")}...`)}}import{interpolate as jl}from"d3";var An=(e,t,r,o,n,a,l,i,s)=>(c,m)=>{s.sunburstLevel[i]=c.data.name,c.parent?(r.datum(c.parent),r.style("cursor","pointer"),o.html(`&#8682; ${c.label}`)):(r.datum(e),r.style("cursor","default"),o.html("")),e.each(u=>u.target={x0:Math.max(0,Math.min(1,(u.x0-c.x0)/(c.x1-c.x0)))*2*Math.PI,x1:Math.max(0,Math.min(1,(u.x1-c.x0)/(c.x1-c.x0)))*2*Math.PI,y0:Math.max(0,u.y0-c.depth),y1:Math.max(0,u.y1-c.depth)});let p=t.transition().duration(m?0:750);n.transition(p).tween("data",u=>{let d=jl(u.current,u.target);return f=>u.current=d(f)}).filter(function(u){return+this.getAttribute("fill-opacity")||ee(u.target)}).attr("fill-opacity",u=>ee(u.target)?1:0).attr("user-select",u=>ee(u.target)?"initial":"none").style("pointer-events",u=>ee(u.target)?"initial":"none").attrTween("d",u=>()=>et(l)(u.current)),a.filter(function(u){return+this.getAttribute("fill-opacity")||ke(u.target)}).transition(p).attr("fill-opacity",u=>+ke(u.target)).attrTween("transform",u=>()=>tt(u.current,l))};function Tn(){let e=null,t=null,r=null,o=null,n=null,a=l=>{let i=l.selectAll("g.segment").data(r.descendants().slice(1)),s=i.enter().append("g").attr("class","segment");s.append("path"),s.append("text").attr("class","segment").attr("dy","0.35em");let c=s.merge(i),m=c.select("path").attr("fill-opacity",h=>ee(h.current)?1:0).attr("user-select",h=>ee(h.current)?"initial":"none").style("pointer-events",h=>ee(h.current)?"initial":"none").attr("d",h=>et(n)(h.current));o&&m.style("fill",h=>o(h.data.color));let p=c.select("text").attr("fill-opacity",h=>+ke(h.current)).attr("transform",h=>tt(h.current,n)).text(h=>h.label).each(function(h){Cn.call(this,h,n)}),u=l.select("text.parent"),d=l.select("circle").attr("r",n).datum(r),f=An(r,l,d,u,m,p,n,t,e);if(e.sunburstLevel){let h=r.descendants().find(g=>g.data.name===e.sunburstLevel[t]);h&&f(h,!0)}else e.sunburstLevel={};d.on("click",h=>f(h,!1)),m.filter(h=>h.children).style("cursor","pointer").on("click",h=>f(h,!1))};return a.settings=(...l)=>l.length?(e=l[0],a):e,a.split=(...l)=>l.length?(t=l[0],a):t,a.data=(...l)=>l.length?(r=l[0],a):r,a.color=(...l)=>l.length?(o=l[0],a):o,a.radius=(...l)=>l.length?(n=l[0],a):n,a}function rt(){let e="element-prefix-unset",t=null,r=null,o=null,n=null,a=null,l=null,i=s=>{let c=F(s,"div.inner-container",()=>s.append("div").attr("class","inner-container")),m=c.node().getBoundingClientRect(),p=m.height,u=m.width-(a?70:0),d=300,f=s.datum(),h=Math.max(1,Math.min(f.length,Math.floor(u/d))),g=Math.ceil(f.length/h);l={width:u/Math.max(h,1),height:Math.min(p,Math.max(p/g,u/Math.max(h,1)))},p/g>l.height*.75&&(l.height=p/g),f.length>1?(c.style("grid-template-columns",`repeat(${h}, ${100/h}%)`),c.style("grid-template-rows",`repeat(${g}, ${l.height}px)`)):(c.style("grid-template-columns","repeat(1, 100%)"),c.style("grid-template-rows","repeat(1, 100%)")),o=c.selectAll(`div.${e}-container`).data(f,y=>y.split),o.exit().remove(),r=o.enter().append("div").attr("class",`${e}-container`),n=r.append("div").attr("class","title-container").style("text-align","center").attr("display","inline-block").append("text").attr("class","title").style("text-align","left"),t=r.append("svg").append("g").attr("class",e)};return i.elementsPrefix=(...s)=>s.length?(e=s[0],i):e,i.chartContainer=()=>t,i.chartEnter=()=>r,i.chartDiv=()=>o,i.chartTitle=()=>n,i.containerSize=()=>l,i}function zn(e,t){if(t.crossValues.length===0){console.warn("Unable to render a chart in the absence of any groups.");return}let r=Qe(t),o=_n(t,r),n=rt().elementsPrefix("sunburst");if(e.datum(r).call(n),o){let m=t.realValues[1];if(t.mainValues.find(p=>p.name===m)?.type==="string"){let p=B().settings(t).scale(o);e.call(p)}else{let p=ue().scale(o);e.call(p)}}let a=n.chartContainer(),l=n.chartEnter(),i=n.chartDiv(),s=n.chartTitle(),c=n.containerSize();s.each((m,p,u)=>Ln(u[p]).text(m.split)),a.append("circle").attr("fill","none").style("pointer-events","all"),a.append("text").attr("class","parent"),l.merge(i).select("svg").select("g.sunburst").attr("transform",`translate(${c.width/2}, ${c.height/2})`).each(function({split:m,data:p}){let u=Ln(this),d=this.parentNode,{width:f,height:h}=d.getBoundingClientRect(),g=(Math.min(f,h)-24)/(t.crossValues.length*2);Tn().settings(t).split(m).data(p).color(o).radius(g)(u),ne().settings(t)(u.selectAll("g.segment"))})}zn.plugin={name:"Sunburst",category:"Hierarchial Chart",max_cells:7500,max_columns:50,render_warning:!0,initial:{type:"number",count:1,names:["Size","Color","Tooltip"]}};var kn=zn;import{select as ct}from"d3";function En(e,t){if(e.realValues.length<1||e.realValues[1]===null||e.realValues[1]===void 0)return;let r=e.realValues[1],o=t.filter(n=>n.height>0).map(n=>Dn(n)).reduce((n,a)=>n.concat(a));if(e.mainValues.find(n=>n.name===r)?.type==="string")return Ge(e,o);{let n=Math.min(...o),a=Math.max(...o);return ce(e,null,null,[n,a])}}function Dn(e,t=[]){return e.children&&e.children.length>0?e.children.forEach(r=>t.concat(Dn(r,t))):e.data.color&&t.push(e.data.color),t}import{select as R}from"d3";var Fn=7,nt=e=>!!(e.target&&e.target.textAttributes),ot=(e,t,r)=>{e.selectAll("text").each(function(n,a){let l=Yl(n,t,r);this.style=l});let o=De(e);Gl(o),Ot(o)},On=e=>{e.each((t,r,o)=>{R(o[r]).selectAll("text").attr("dx",t.target.textAttributes.dx).attr("dy",t.target.textAttributes.dy).attr("style",t.target.textAttributes.style)})},Ot=e=>{let t=-2,r=14,o=a=>a.getBoundingClientRect(),n=[];e.selectAll("text").filter((a,l,i)=>R(i[l]).attr("style")===ge.high).each((a,l,i)=>n.push(i[l])),e.selectAll("text").filter((a,l,i)=>R(i[l]).attr("style")===ge.low).each((a,l,i)=>{let s=i[l];n.filter(c=>_t("x",o(c),o(s))&&_t("y",o(c),o(s),t)).forEach(()=>R(s).attr("dy",Number(R(s).attr("dy"))+r))})},Nn=e=>R(e).style("opacity",Ee[R(e).attr("class")]),Mn=e=>R(e).style("opacity",null),Ee={top:1,mid:.7,lower:0},De=e=>e.filter((t,r,o)=>R(o[r]).selectAll("text").attr("style")!==ge.zero),at=e=>e.selectAll("text").each((t,r,o)=>Wl(o[r])),Gl=e=>e.selectAll("text").each((t,r,o)=>Rn(o[r])),Rn=e=>{let t=R(e),r=e.getBoundingClientRect();t.attr("dx",0-r.width/2).attr("dy",0+r.height/4)},Wl=e=>{let r=e.parentNode.childNodes[0],o=e.getBBox(),n=r.getBBox();Ul(e,n,o)||R(e).attr("style",R(e).attr("style"))},Ul=(e,t,r)=>{let o=Math.min(t.height/r.height,t.width/r.width);if(o<1){let n=parseInt(R(e).style("font-size")),a=Math.floor(n*o);return n>Fn&&a>Fn?(R(e).style("font-size",`${a}px`),Rn(e)):(R(e).style("font-size",null),R(e).style("opacity","0")),!0}return!1},Yl=(e,t,r)=>{if(!r.filter(o=>o!=="").every(o=>e.crossValue.includes(o)))return ge.zero;switch(e.depth){case t+1:return ge.high;case t+2:return ge.low;default:return ge.zero}},ge={high:"font-size:14px;z-index:5;pointer-events: none;",low:"font-size:8px;opacity:0.7;z-index:4;",zero:"font-size:0px;opacity:0;z-index:4;"};import{treemap as Kl,treemapBinary as Zl}from"d3";var lt=(e,t)=>{let r=Kl().size([e,t]).paddingInner(o=>1+2*(o.height-1));return r.tile(Zl),r};import{easeCubicOut as In,interpolate as Hn,select as $t}from"d3";import{hierarchy as Xl,select as Nt}from"d3";var ql=(e,t)=>t.every(r=>e.crossValue.includes(r));function Mt(e,t,r,o,n,a){Jl(e,t,r,o,n),e.mapLevel[o].levelRoot=!0,Ql(e,a.node().getBoundingClientRect().width,a.node().getBoundingClientRect().height,o),Bn(r,o)}function Pn(e,t){e.each(r=>{r.mapLevel=[],r.mapLevel[0]={x0:r.x0,x1:ye(r)+r.x0,y0:r.y0,y1:xe(r)+r.y0,visible:!0,opacity:1}}),t.mapLevel[0].levelRoot=!0,Bn(e,0)}var it=(e,t)=>{e.each((r,o,n)=>{let a=Nt(n[o]).selectAll("text");r.mapLevel[t].textAttributes={dx:a.attr("dx"),dy:a.attr("dy"),class:a.attr("class"),"font-size":a.style("font-size")}})};function Jl(e,t,r,o,n){let a={x:e.x0,y:e.y0,width:e.x1-e.x0,height:e.y1-e.y0},l={width:n.x1-n.x0,height:n.y1-n.y0},i={width:l.width/a.width,height:l.height/a.height};r.each(s=>{let c=(s.x0-a.x)*i.width,m=(s.y0-a.y)*i.height,p=ye(s)*i.width,u=xe(s)*i.height,d=ql(s,t)&&s.data.name!==t[o-1];s.mapLevel[o]={x0:c,x1:p+c,y0:m,y1:u+m,visible:d,opacity:d?1:0}}),e.mapLevel[o].levelRoot=!0}function Ql(e,t,r,o){let l=lt(t,r)(Xl(e.data).sum(s=>s.size)).descendants(),i=e.descendants();l.forEach((s,c)=>{i[c].mapLevel[o].x0=l[c].x0,i[c].mapLevel[o].x1=l[c].x1,i[c].mapLevel[o].y0=l[c].y0,i[c].mapLevel[o].y1=l[c].y1})}function Bn(e,t){e.selectAll("text").each((r,o,n)=>{let a=Nt(n[o]),l=Nt(n[o]).datum(),i=a.attr("class");l.mapLevel[t].textLockedAt={opacity:Ee[i]}})}function $n(e,t,r,o,n,a,l,i,s){if(o.treemapLevel>0){let c=l.crossValue;Pt(l,e,t,r,o,n,a,l,0,c,i,s,1,!1),o.treemapRoute.slice(1,o.treemapRoute.length).forEach(m=>{let p=t.filter(d=>d.crossValue===m).datum(),u=p.crossValue;Mt(p,u,t,p.depth,l,n),Pt(p,e,t,r,o,n,a,l,p.depth,u,i,s,1,!1)})}}function Rt(e,t,r,o,n,a,l,i,s,c){if(!e.children)return;n.treemapLevel<e.depth?n.treemapRoute.push(e.crossValue):n.treemapRoute.pop(),n.treemapLevel=e.depth;let m=e.crossValue;(!e.mapLevel[n.treemapLevel]||!e.mapLevel[n.treemapLevel].levelRoot)&&Mt(e,m,r,n.treemapLevel,i,a),Pt(e,t,r,o,n,a,l,i,n.treemapLevel,m,s,c)}function Pt(e,t,r,o,n,a,l,i,s,c,m,p,u=500,d=!0){let f=e.parent,h=l.transition("main transition").duration(u).ease(In);r.each(y=>y.target=y.mapLevel[s]),nt(e)||ni(r,m),r.transition(h).tween("data",y=>{let b=Hn(y.current,y.target);return v=>y.current=b(v)}).styleTween("opacity",y=>()=>y.current.opacity).attrTween("pointer-events",y=>()=>y.target.visible?"all":"none"),t.transition(h).filter(y=>y.target.visible).styleTween("x",y=>()=>`${y.current.x0}px`).styleTween("y",y=>()=>`${y.current.y0}px`).styleTween("width",y=>()=>`${y.current.x1-y.current.x0}px`).styleTween("height",y=>()=>`${y.current.y1-y.current.y0}px`),o.transition(h).filter(y=>y.target.visible).attrTween("x",y=>()=>y.current.x0+ye(y.current)/2).attrTween("y",y=>()=>y.current.y0+xe(y.current)/2).end().catch(()=>Bt(r)).then(()=>{nt(e)||(Ot(g),at(g),ei(o,l,u),d&&it(r,s),Bt(r,m,f))}).catch(y=>{console.error("Exception completing promises after main transition",y),Bt(r,m,f)}),nt(e)?On(r):(o.each((y,b,v)=>Nn(v[b])),ot(r,s,c));let g=De(r);f?m.hide(!1).text(e.label).onClick(()=>{Rt(f,t,r,o,n,a,l,i,m,p);let y=a.node().getRootNode().host.parentElement;Le(y,f,p)})():m.hide(!0)()}async function ei(e,t,r=400){let o=t.transition("text fade transition").duration(r).ease(In);await e.transition(o).filter(n=>n.target.visible).tween("data",(n,a,l)=>{let i=l[a],s=Hn(ti(n),ri(i));return c=>n.current.opacity=s(c)}).styleTween("opacity",n=>()=>n.current.opacity).end().catch(n=>console.error("Exception in text fade transition",n)).then(()=>e.each((n,a,l)=>Mn(l[a])))}var ti=e=>e.target.textLockedAt.opacity,ri=e=>Ee[$t(e).attr("class")],ni=(e,t)=>{t.deactivate(!0),e.each((r,o,n)=>{$t(n[o]).selectAll("rect").style("pointer-events","none")})},Bt=(e,t)=>{t&&t.deactivate(!1),e.each((r,o,n)=>{$t(n[o]).selectAll("rect").style("pointer-events",null)})};var jn=`<button id="goto-parent">Goto parent</button>
`;function Gn(e){let t=null,r=null,o=!0,n=!1,a=F(e,".parent-controls",()=>e.append("div").attr("class","parent-controls").style("display",o?"none":"").html(jn)),l=()=>{a.style("display",o?"none":"").select("#goto-parent").style("pointer-events",n?"none":null).html(`\u21EA ${r}`).on("click",()=>t())};return l.deactivate=(...i)=>{if(!i.length)return n;n=i[0];let s=a.select("#goto-parent");return n?s.style("pointer-events","none"):s.style("pointer-events",null),l},l.hide=(...i)=>i.length?(o=i[0],l):o,l.text=(...i)=>i.length?(r=i[0],l):r,l.onClick=(...i)=>i.length?(t=i[0],l):t,l}var st={leaf:"leafnode",branch:"branchnode",root:"rootnode"},ye=e=>e.x1-e.x0,xe=e=>e.y1-e.y0,ai=(e,t)=>t.depth===e,Wn=(e,t)=>t.depth===0?st.root:ai(e,t)?st.leaf:st.branch;function Un(){let e=null,t=null,r=null,o=null,n=null,a=null,l=i=>{a=Gn(n),a();let s=r.height;e.treemapLevel||(e.treemapLevel=0),e.treemapRoute||(e.treemapRoute=[]),lt(n.node().getBoundingClientRect().width,n.node().getBoundingClientRect().height)(r);let m=i.selectAll("g").data(r.descendants()),p=m.enter().append("g");p.append("rect"),p.append("text");let u=p.merge(m).sort((g,y)=>y.depth-g.depth),d=u.select("rect").attr("class",g=>`treerect ${Wn(s,g)}`).style("x",g=>g.x0).style("y",g=>g.y0).style("width",g=>ye(g)).style("height",g=>xe(g));d.style("fill",g=>Wn(s,g)===st.leaf?g.data.color?o(g.data.color):t.colorStyles.series:"transparent");let f=u.filter(g=>g.value!==0).select("text").attr("x",g=>g.x0+ye(g)/2).attr("y",g=>g.y0+xe(g)/2).text(g=>g.label),h=d.filter(g=>g.crossValue.length===0).datum();Pn(u,h),ot(u,0,[]),at(De(u)),it(u,0),e.treemapRoute.length===0&&e.treemapRoute.push(h.crossValue),d.filter(g=>g.children).on("click",(g,y)=>Rt(y,d,u,f,e,n,i,h,a,t)),$n(d,u,f,e,n,i,h,a,t)};return l.settings=(...i)=>i.length?(e=i[0],t=i[1],l):e,l.data=(...i)=>i.length?(r=i[0],l):r,l.color=(...i)=>i.length?(o=i[0],l):o,l.container=(...i)=>i.length?(n=i[0],l):n,l}function Yn(e,t){if(t.crossValues.length===0){console.warn("Unable to render a chart in the absence of any groups.");return}t.treemaps||(t.treemaps={});let r=Qe(t),o=En(t,r.map(s=>s.data));o&&this._container.classList.add("has-legend");let n=rt().elementsPrefix("treemap");if(e.datum(r).call(n),o){let s=t.realValues[1];if(t.mainValues.find(c=>c.name===s)?.type==="string"){let c=B().settings(t).scale(o);e.call(c)}else{let c=ue().scale(o);e.call(c)}}let a=n.chartEnter(),l=n.chartDiv();n.chartTitle().each((s,c,m)=>ct(m[c]).text(s.split)),a.merge(l).select("svg").select("g.treemap").each(function({split:s,data:c}){let m=ct(this);t.treemaps[s]||(t.treemaps[s]={}),Un().settings(t.treemaps[s],t).data(c).container(ct(ct(this.parentNode).node().parentNode)).color(o)(m),ne().settings(t).centered(!0)(m.selectAll("g"))})}Yn.plugin={type:"Treemap",name:"Treemap",category:"Hierarchial Chart",max_cells:5e3,max_columns:50,render_warning:!0,initial:{type:"number",count:1,names:["Size","Color","Tooltip"]}};var Kn=Yn;var li=[Mr,Gr,Yr,qr,tn,ln,dn,vn,Sn,Kn,kn,gn],It=li;import{color as Xn}from"d3";import{parse as mi}from"gradient-parser";var Zn=(e,t)=>{if(!t.colorStyles){let r={scheme:[],gradient:{},interpolator:{},grid:{}},o=ci(e);r.series=o("--d3fc-local-series");for(let a=1;;a++){let l=`series-${a}`,i=o(`--d3fc-local-${l}`);if(!i)break;r[l]=i,r.scheme.push(i)}r.opacity=ii(r.series),r.grid.gridLineColor=o`--d3fc-gridline--color`,["full","positive","negative"].forEach(a=>{let l=o(`--d3fc-local-${a}--gradient`);r.gradient[a]=ui(l,r.opacity)}),t.colorStyles=r}},ii=e=>Xn(e).opacity,si=(e,t)=>{let r=Xn(`#${e}`);return r.opacity=t,r+""},ci=e=>{let t=getComputedStyle(e);return r=>t?.getPropertyValue(r)},ui=(e,t)=>{let r=mi(e)[0].colorStops;return r.map((o,n)=>[o.length?o.length.value/100:n/(r.length-1),si(o.value,t)]).sort((o,n)=>o[0]-n[0])};var qn=`:host .chart{--d3fc-local-full--gradient: var(--d3fc-full--gradient, linear-gradient(#4d342f 0%, #e4521b 22.5%, #feeb65 42.5%, #f0f0f0 50%, #dcedc8 57.5%, #42b3d5 67.5%, #1a237e 100%));--d3fc-local-positive--gradient: var(--d3fc-positive--gradient, linear-gradient(#dcedc8 0%, #42b3d5 35%, #1a237e 100%));--d3fc-local-negative--gradient: var(--d3fc-negative--gradient, linear-gradient(#feeb65 100%, #e4521b 70%, #4d342f 0%))}:host .chart{--d3fc-local-series: var(--d3fc-series, rgba(31, 119, 180, .5));--d3fc-local-series-1: var(--d3fc-series-1, #0366d6);--d3fc-local-series-2: var(--d3fc-series-2, #ff7f0e);--d3fc-local-series-3: var(--d3fc-series-3, #2ca02c);--d3fc-local-series-4: var(--d3fc-series-4, #d62728);--d3fc-local-series-5: var(--d3fc-series-5, #9467bd);--d3fc-local-series-6: var(--d3fc-series-6, #8c564b);--d3fc-local-series-7: var(--d3fc-series-7, #e377c2);--d3fc-local-series-8: var(--d3fc-series-8, #7f7f7f);--d3fc-local-series-9: var(--d3fc-series-9, #bcbd22);--d3fc-local-series-10: var(--d3fc-series-10, #17becf)}:host .chart .series{fill:var(--d3fc-local-series)}:host .chart .series-1{fill:var(--d3fc-local-series-1)}:host .chart .series-2{fill:var(--d3fc-local-series-2)}:host .chart .series-3{fill:var(--d3fc-local-series-3)}:host .chart .series-4{fill:var(--d3fc-local-series-4)}:host .chart .series-5{fill:var(--d3fc-local-series-5)}:host .chart .series-6{fill:var(--d3fc-local-series-6)}:host .chart .series-7{fill:var(--d3fc-local-series-7)}:host .chart .series-8{fill:var(--d3fc-local-series-8)}:host .chart .series-9{fill:var(--d3fc-local-series-9)}:host .chart .series-10{fill:var(--d3fc-local-series-10)}:host{user-select:none}:host .chart{position:absolute;box-sizing:border-box;left:0;top:0;width:100%;height:100%;padding:15px;overflow:hidden}:host .chart.heatmap d3fc-group.cartesian-chart,:host .chart.treemap d3fc-group.cartesian-chart{grid-template-columns:minmax(0em,max-content) auto 1fr auto minmax(0em,max-content);grid-template-rows:minmax(0em,max-content) auto 1fr auto minmax(0em,max-content)}:host .chart .chart-label{display:none}:host .chart.heatmap{padding-right:120px}:host .chart.sunburst{padding:0;font-size:14px}:host .chart.sunburst .inner-container{width:100%;height:100%;display:inline-grid;padding:0;margin:0;overflow-x:hidden;overflow-y:auto}:host .chart.sunburst .inner-container div{overflow:hidden}:host .chart.sunburst .inner-container .sunburst-container:not(:only-child) svg{transform:translateY(-27px)}:host .chart.sunburst .inner-container svg{width:100%;height:100%}:host .chart.sunburst .inner-container path{fill:var(--d3fc-series, rgba(31, 119, 180, .5))}:host .chart.sunburst .inner-container text.segment,:host .chart.sunburst .inner-container text.parent{text-anchor:middle;user-select:none;pointer-events:none;fill:var(--d3fc-treedata--labels, #333333)}:host .chart.sunburst .inner-container div.title-container{margin-top:5px}:host .chart.has-legend{padding-right:120px}:host .chart.treemap .treemap-container{position:relative}:host .chart.treemap .treemap-container:not(:only-child){width:calc(100% - 12px);height:calc(100% - 12px)}:host .chart.treemap .inner-container{width:100%;height:100%;display:inline-grid;padding:0;margin:0;overflow-x:hidden;overflow-y:auto}:host .chart.treemap .inner-container div{overflow:hidden}:host .chart.treemap .inner-container svg{width:100%;height:100%}:host .chart.treemap .inner-container .treerect{stroke:var(--d3fc-treedata-axis--lines, var(--d3fc-axis--lines, white));fill:var(--d3fc-series, rgba(31, 119, 180, .5))}:host .chart.treemap .inner-container .treerect:hover{cursor:pointer;stroke:var(--d3fc-treedata--hover-highlight, black);stroke-opacity:1}:host .chart.treemap .inner-container .rootnode{opacity:0;pointer-events:none;z-index:0}:host .chart.treemap .inner-container .branchnode{opacity:0}:host .chart.treemap .inner-container .branchnode:hover{fill-opacity:.1;opacity:1;fill:var(--d3fc-treedata--hover-highlight, black)}:host .chart.treemap .inner-container .leafnode{fill-opacity:.8}:host .chart.treemap .inner-container .leafnode:hover{fill-opacity:.5}:host .chart.treemap .inner-container #hidden{opacity:0;pointer-events:none;z-index:0}:host .chart.treemap .inner-container .top{font-size:14px;z-index:5;pointer-events:none}:host .chart.treemap .inner-container .mid{font-size:8px;opacity:.7;z-index:4}:host .chart.treemap .inner-container .lower{font-size:0px;opacity:0;z-index:4}:host .chart.treemap .inner-container text{fill:var(--d3fc-treedata--labels, #333333)}:host .chart.treemap .inner-container text.title{dominant-baseline:hanging}:host .chart.treemap .inner-container .parent-controls{position:absolute;top:15px;right:auto;left:30px;width:auto;z-index:4;transition:box-shadow 1s}:host .chart.treemap .inner-container .parent-controls:hover{box-shadow:2px 2px 6px #000;transition:box-shadow .2s}:host .chart .x-label{height:1.2em!important;line-height:1em!important}:host .chart .x-label,:host .chart .y-label{color:var(--d3fc-label--color, inherit);font-size:14px}:host .chart d3fc-canvas.plot-area{display:none}:host .chart.xyscatter d3fc-canvas.plot-area,:host .chart.xyline d3fc-canvas.plot-area,:host .chart.ohlc d3fc-canvas.plot-area,:host .chart.candlestick d3fc-canvas.plot-area,:host .chart.heatmap d3fc-canvas.plot-area{display:block}:host .chart .y-axis text,:host .chart .x-axis text{fill:var(--d3fc-axis-ticks--color, #505050);font-size:11px}:host .chart .y-axis path,:host .chart .x-axis path{stroke:var(--d3fc-axis--lines, #b4d2e1)}:host .chart .splitter-label{display:inline-block;margin:0 10px;cursor:pointer}:host .chart .splitter-label:after{margin-left:5px;color:var(--d3fc-axis--lines, #b4d2e1)}:host .chart .splitter-label:hover:after{color:var(--d3fc-axis-ticks--color, #505050)}:host .chart .splitter-label.disabled{cursor:default}:host .chart .splitter-label.disabled:after{color:#5050504d}:host .chart .y-label.left-label .splitter-label:after{font-family:var(--d3fc-y1-label--font-family, var(--button--font-family, inherit));content:var(--d3fc-y1-label--content, "\\1f847")}:host .chart .y-label.right-label .splitter-label:after{font-family:var(--d3fc-y2-label--font-family, var(--button--font-family, inherit));content:var(--d3fc-y2-label--content, "\\1f845")}:host .chart.ybar .y-axis path,:host .chart.yline .y-axis path,:host .chart.xyline .y-axis path,:host .chart.xyline .x-axis path,:host .chart.yarea .y-axis path,:host .chart.yscatter .y-axis path,:host .chart.xyscatter .y-axis path,:host .chart.xyscatter .x-axis path,:host .chart.xbar .x-axis path{visibility:hidden}:host .chart .y-label{white-space:nowrap}:host .chart .nearbyTip{fill:var(--d3fc-series, rgba(31, 119, 180, .5))}:host #dragHandles{position:absolute;top:0px;right:0px;left:auto;pointer-events:none}:host #dragHandles rect{pointer-events:all}:host .label rect{fill:none}:host .legend-container{position:absolute;top:15px;right:15px;left:auto;width:150px;height:280px}:host .legend-container.legend-color{width:90px;height:150px}:host .legend-container[borderbox-on-hover=true]{transition:box-shadow 1s}:host .legend-container[borderbox-on-hover=true]:hover{background-color:var(--d3fc-legend--background, #ffffff);box-shadow:0 2px 4px #0000001a;transition:box-shadow .2s,background-color .2s}:host .legend-container .legend{font-size:8pt;width:100%}:host .legend-container .legend .cell{cursor:pointer}:host .legend-container .legend .cell path{fill:var(--d3fc-series, rgba(31, 119, 180, .5));stroke:var(--d3fc-series, #1f77b4)}:host .legend-container .legend .cell.hidden path{fill:#cccccc80;stroke:#ccc}:host .legend-container .legend .cell.hidden circle{fill:#ccc!important}:host .legend-container text{fill:var(--d3fc-legend--text, #333333)}:host .legend-container .label:hover{fill:#22a0ce}:host .legend-container #legend-axis path{stroke:var(--d3fc-legend--text, #333333)}:host .legend-container .legend-controls{margin-left:12px}:host .legend-container .legend-controls #up-arrow,:host .legend-container .legend-controls #down-arrow{cursor:pointer;color:#1f77b4}:host .legend-container .legend-controls #up-arrow.disabled,:host .legend-container .legend-controls #down-arrow.disabled{cursor:default;color:#333}:host .heatmap .legend-container.legend-color{height:200px}:host .treemap .legend-container.legend-color{height:200px}:host .treemap .legend-container:not(.legend-color){width:100px}:host .zoom-controls{position:absolute;top:10px;left:0;width:100%;text-align:center}:host .zoom-controls button{-webkit-appearance:none;background:var(--plugin--background, #f7f7f7);border:1px solid var(--inactive--color, #cccccc);color:var(--d3fc-label--color, inherit);font-size:12px;padding:8px;opacity:.5;cursor:pointer}:host .zoom-controls button:hover{opacity:1}:host .parent-controls{position:absolute;top:30px;right:145px;width:100%;text-align:right}:host .parent-controls button{-webkit-appearance:none;background:#f7f7f7;border:1px solid #cccccc;padding:10px;opacity:.5;cursor:pointer}:host .parent-controls button:hover{background:#e6e6e6}:host div.tooltip{position:absolute;text-align:left;font-size:12px;font-weight:300;white-space:nowrap;padding:.5em;background:var(--d3fc-tooltip--background, #ffffff);color:var(--d3fc-tooltip--color, black);border:1px solid var(--d3fc-tooltip--border-color, #777777);box-shadow:var(--d3fc-tooltip--box-shadow, none);pointer-events:none}:host div.tooltip ul{margin:0;padding:0;list-style-type:none}
`;import{select as gi}from"d3";var Jn={initial:{type:"number",count:1},selectMode:"select"},pi=`${qn}${fi()}`,Ht=["crossValues","mainValues","realValues","splitValues","filter","data","size","colorStyles","agg_paths","treemaps"];function fi(){let e=document.querySelector("head").querySelectorAll("style"),t=[];return e.forEach(r=>{r.innerText.indexOf("d3fc-")!==-1&&t.push(r.innerText)}),t.join("")}function hi(e){customElements.get("perspective-viewer").registerPlugin(e)}function Qn(...e){e=new Set(e.length>0?e:It.map(t=>t.plugin.name)),It.forEach(t=>{if(e.has(t.plugin.name)){let r=t.plugin.name.toLowerCase().replace(/[ \t\r\n\/]*/g,""),o=`perspective-viewer-d3fc-${r}`;customElements.define(o,class extends HTMLElement{constructor(){super();this._chart=null,this._settings=null,this.render_warning=!0}connectedCallback(){this._initialized||(this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=`<style>${pi}</style>`,this.shadowRoot.innerHTML+='<div id="container" class="chart"></div>',this._container=this.shadowRoot.querySelector(".chart"),this._initialized=!0)}get name(){return t.plugin.name}get category(){return t.plugin.category}get select_mode(){return t.plugin.selectMode||"select"}get min_config_columns(){return t.plugin.initial?.count||Jn.initial.count}get config_column_names(){return t.plugin.initial?.names||Jn.initial.names}get max_cells(){return t.plugin.max_cells||4e3}set max_cells(n){t.plugin.max_cells=n}get max_columns(){return t.plugin.max_columns||50}set max_columns(n){t.plugin.max_columns=n}async render(){var n=document.createElement("canvas"),a=this.shadowRoot.querySelector("#container");n.width=a.offsetWidth,n.height=a.offsetHeight;let l=n.getContext("2d");l.fillStyle=window.getComputedStyle(this).getPropertyValue("--plugin--background")||"white",l.fillRect(0,0,n.width,n.height);let i=window.getComputedStyle(this).getPropertyValue("color"),s=Array.from(this.shadowRoot.querySelectorAll("svg:not(#dragHandles)"));for(let u of s.reverse()){var c=document.createElement("img");c.width=u.parentNode.offsetWidth,c.height=u.parentNode.offsetHeight;let d=u.cloneNode(!0);d.hasAttribute("viewBox")||d.setAttribute("viewBox",`0 0 ${c.width} ${c.height}`),d.setAttribute("xmlns","http://www.w3.org/2000/svg");for(let h of d.querySelectorAll("text"))h.setAttribute("fill",i);var m=new XMLSerializer().serializeToString(d);m=m.replace(/[^\x00-\x7F]/g,"");let f=new Promise((h,g)=>{c.onload=h,c.onerror=g});try{c.src=`data:image/svg+xml;base64,${btoa(m)}`,await f}catch{let g=new Promise((y,b)=>{c.onload=y,c.onerror=b});c.src=`data:image/svg+xml;utf8,${m}`,await g}l.drawImage(c,u.parentNode.offsetLeft,u.parentNode.offsetTop,c.width,c.height)}let p=Array.from(this.shadowRoot.querySelectorAll("canvas"));for(let u of p.reverse())l.drawImage(u,u.parentNode.offsetLeft,u.parentNode.offsetTop,u.width/window.devicePixelRatio,u.height/window.devicePixelRatio);return await new Promise(u=>n.toBlob(d=>u(d)),"image/png")}async draw(n,a,l){!this.isConnected||(this.config=await this.parentElement.save(),await this.update(n,a,l,!0))}async update(n,a,l,i=!1){if(!this.isConnected)return;let s=this.parentElement,c,m,p=this.config.columns,u=t.plugin.name!=="Sunburst";a&&l?c=n.to_json({end_row:l,end_col:a,leaves_only:u}):a?c=n.to_json({end_col:a,leaves_only:u}):l?c=n.to_json({end_row:l,leaves_only:u}):c=n.to_json({leaves_only:u}),m=await Promise.all([s.getTable().then(V=>V.schema(!1)),n.expression_schema(!1),n.schema(!1),c,n.get_config()]);let[d,f,h,g,y]=m,b=function(V){let C=d[V];return C||(C=f[V]),C},{columns:v,group_by:x,split_by:S,filter:_}=y,L=x.length>0?g.reduce((V,C)=>{if(C.__ROW_PATH__&&C.__ROW_PATH__.length==x.length)V.agg_paths.push(V.aggs.slice()),V.rows.push(C);else{let D=C.__ROW_PATH__.filter(U=>U!==void 0).length;V.aggs[D]=C,V.aggs=V.aggs.slice(0,D+1)}return V},{rows:[],aggs:[],agg_paths:[]}):{rows:g},P=(V,C)=>x.length?V:{...V,__ROW_PATH__:[C]},I=L.rows.map(P),E={realValues:p,crossValues:x.map(V=>({name:V,type:b(V)})),mainValues:v.map(V=>({name:V,type:h[V]})),splitValues:S.map(V=>({name:V,type:b(V)})),filter:_,data:I,agg_paths:L.agg_paths};this._chart=t;let k={set:(V,C,D)=>(Ht.includes(C)||this._container&&this._container.dispatchEvent(new Event("perspective-plugin-update",{bubbles:!0,composed:!0})),V[C]=D,!0)};this._settings=new Proxy({...this._settings,...E},k),this._settings.splitMainValues&&this._settings.splitMainValues.length>=v.length&&(this._settings.splitMainValues=[]),Zn(this._container,this._settings),i&&(this._container.innerHTML=""),this._draw(),await new Promise(V=>requestAnimationFrame(V))}async clear(){this._container&&(this._container.innerHTML="")}_draw(){if(this._settings.data&&this.isConnected){let n=gi(this._container),a=`chart ${r}`;this._settings.size=this._container.getBoundingClientRect(),this._settings.data.length>0?this._chart(n.attr("class",a),this._settings):n.attr("class",`${a} disabled`)}}async resize(){this.isConnected&&this._draw()}async restyle(...n){let a=this._settings;a&&(delete a.colorStyles,await this.draw(...n))}async delete(){this._container.innerHTML=""}getContainer(){return this._container}save(){let n={...this._settings};return Ht.forEach(a=>{delete n[a]}),n}restore(n){let a={};for(let l of Ht)a[l]=this._settings?.[l];this._settings={...a,...n},this._draw()}}),customElements.whenDefined("perspective-viewer").then(()=>hi(o))}})}Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector);Qn("Candlestick");
//# sourceMappingURL=candlestick.js.map
