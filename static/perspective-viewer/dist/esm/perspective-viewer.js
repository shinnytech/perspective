var c=class extends HTMLElement{constructor(){super()}get name(){return"Debug"}get select_mode(){return"select"}get min_config_columns(){}get config_column_names(){}async update(t){return this.draw(t)}async draw(t){this.style.backgroundColor="#fff";let r=await t.to_csv(),i="margin:0;overflow:scroll;position:absolute;width:100%;height:100%";this.innerHTML=`<pre style='${i}'>${r}</pre>`}async clear(){this.innerHTML=""}async resize(){}async restyle(){}async save(){}async restore(){}async delete(){}};document.createElement("perspective-viewer-plugin").constructor===HTMLElement&&window.customElements.define("perspective-viewer-plugin",c);import{PerspectiveViewerElement as L,register_plugin as M,get_exprtk_commands as k}from"@finos/perspective-viewer/dist/pkg/perspective_viewer.js";import{Decompress as h}from"fflate";import P from"@finos/perspective-viewer/dist/pkg/perspective_viewer.js";import E from"@finos/perspective-viewer/dist/pkg/perspective_viewer_bg.wasm";window.addEventListener("unhandledrejection",e=>{e.reason?.message==="View method cancelled"&&e.preventDefault()});function f(e){return new Uint32Array(e.slice(0,4))[0]==559903}async function T(){let e=await E,t=[],r=0,i=new h(s=>{s&&(r+=s.byteLength,t.push(s))});if(e instanceof URL||typeof e=="string"){let m=(await fetch(e.toString())).body.getReader(),a=0;for(;;){let{value:l,done:d}=await m.read();if(d)break;a===0&&f(l.buffer)||a===1?(a=1,i.push(l,d)):(a=2,r+=l.byteLength,t.push(l))}}else if(e instanceof Uint8Array)f(e.buffer)?i.push(e,!0):(r=e.byteLength,t=[e]);else{let s=new Uint8Array(e);f(e)?i.push(s,!0):(r=s.byteLength,t=[s])}let n=0,o=new Uint8Array(r);for(let s of t)o.set(s,n),n+=s.byteLength;return await P(o)}var u=T();var p=class extends HTMLElement{constructor(){super();this.load_wasm()}async load_wasm(){await u,this.instance||(this.instance=new L(this))}async connectedCallback(){await this.load_wasm(),this.instance.connected_callback()}static async registerPlugin(t){await u,M(t)}async load(t){await this.load_wasm(),await this.instance.js_load(Promise.resolve(t))}async notifyResize(t=!1){await this.load_wasm(),await this.instance.js_resize(t)}async setAutoSize(t=!0){await this.load_wasm(),await this.instance.js_set_auto_size(t)}async getTable(t){return await this.load_wasm(),await this.instance.js_get_table(!!t)}async getView(){return await this.load_wasm(),await this.instance.js_get_view()}async restore(t){await this.load_wasm(),await this.instance.js_restore(t)}async save(t){return await this.load_wasm(),await this.instance.js_save(t)}async flush(){await this.load_wasm(),await this.instance.js_flush()}async reset(t=!1){await this.load_wasm(),await this.instance.js_reset(t)}async delete(){await this.load_wasm(),await this.instance.js_delete()}async download(t){await this.load_wasm(),await this.instance.js_download(t)}async copy(t){await this.load_wasm(),await this.instance.js_copy(t)}async restyleElement(){await this.load_wasm(),await this.instance.js_restyle_element()}async resetThemes(t){await this.load_wasm(),await this.instance.js_reset_themes(t)}async getEditPort(){return await this.load_wasm(),await this.instance.js_get_edit_port()}async setThrottle(t){await this.load_wasm(),await this.instance.js_set_throttle(t)}async toggleConfig(t){await this.load_wasm(),await this.instance.js_toggle_config(t)}async getPlugin(t){return await this.load_wasm(),await this.instance.js_get_plugin(t)}async getAllPlugins(){return await this.load_wasm(),await this.instance.js_get_all_plugins()}async unsafe_get_model(){return await this.load_wasm(),await this.instance.js_unsafe_get_model()}static async getExprtkCommands(){return await u,k()}};document.createElement("perspective-viewer").constructor===HTMLElement&&window.customElements.define("perspective-viewer",p);function Z(e,{warn:t=!0,replace_defaults:r=!1}={}){if(typeof e=="object"&&!(e instanceof ArrayBuffer)){let i=JSON.parse(JSON.stringify(e));return"viewers"in i&&"detail"in i?D(i,{warn:t,replace_defaults:r}):_(i,!1,{warn:t,replace_defaults:r})}else return e}function D(e,t){for(let r in e.viewers)e.viewers[r]=_(e.viewers[r],!0,t),"master"in e.viewers[r]||(e.viewers[r].master=!1,t.warn&&console.warn('Deprecated perspective missing attribute "master" set to default')),"linked"in e.viewers[r]||(e.viewers[r].linked=!1,t.warn&&console.warn('Deprecated perspective missing attribute "linked" set to default'));return e}function _(e,t,r){return x(e,[V,j,A,$,r.replace_defaults?H:!1,C,Y,t?R:B].filter(i=>!!i),r)}function x(e,t,r){for(let i of t)e=i(e,r);return e}function H(e,t){for(let r of["group_by","split_by","filter","sort"])e[r]===null&&(e[r]=[],t.warn&&console.warn(`Deprecated perspective missing attribute "${r}" set to default"`)),"aggregates"in e&&e.aggregates===null&&(e.aggregates={},t.warn&&console.warn('Deprecated perspective missing attribute "aggregates" set to default"'));return e}function g(e,t){return function(r,i){let n=0;for(let o of t)if(o in r){if(n++>0)throw new Error(`Duplicate "${e}" fields`);r[e]=r[o],o!==e&&(delete r[o],i.warn&&console.warn(`Deprecated perspective attribute "${o}" renamed "${e}"`))}return r}}var V=g("group_by",["group_by","row_pivots","row-pivot","row-pivots","row_pivot"]),j=g("split_by",["split_by","column_pivots","column-pivot","column-pivots","column_pivot","col_pivots","col-pivot","col-pivots","col_pivot"]),A=g("filter",["filter","filters"]);function S(e,t,r,i,n){if(e.test(r)){let o=r.replace(e,t);n.warn&&console.warn(`Deprecated perspective "expression" attribute value "${r}" updated to "${o}"`);for(let s of["group_by","split_by"])if(s in i)for(let m in i[s])i[s][m]===r.replace(/"/g,"")&&(i[s][m]=o,n.warn&&console.warn(`Deprecated perspective expression in "${s}" attribute "${r}" replaced with "${o}"`));for(let s of i.filter||[])s[0]===r.replace(/"/g,"")&&(s[0]=o,n.warn&&console.warn(`Deprecated perspective expression in "filter" attribute "${r}" replaced with "${o}"`));for(let s of i.sort||[])s[0]===r.replace(/"/g,"")&&(s[0]=o,n.warn&&console.warn(`Deprecated perspective expression in "sort" attribute "${r}" replaced with "${o}"`));return o}else return r}function $(e,t){if(e["computed-columns"]){if("expressions"in e)throw new Error('Duplicate "expressions" and "computed-columns');e.expressions=e["computed-columns"],delete e["computed-columns"],t.warn&&console.warn('Deprecated perspective attribute "computed-columns" renamed "expressions"');let r=[[/^year_bucket\("(.+?)"\)/,`bucket("$1", 'y')`],[/^month_bucket\("(.+?)"\)/,`bucket("$1", 'M')`],[/^day_bucket\("(.+?)"\)/,`bucket("$1", 'd')`],[/^hour_bucket\("(.+?)"\)/,`bucket("$1", 'h')`],[/^minute_bucket\("(.+?)"\)/,`bucket("$1", 'm')`],[/^second_bucket\("(.+?)"\)/,`bucket("$1", 's')`]];for(let i in e.expressions){let n=e.expressions[i];for(let[o,s]of r)n=S(o,s,n,e,t);e.expressions[i]=n}}return e}function C(e,t){let r={datagrid:"Datagrid",Datagrid:"Datagrid",d3_y_area:"Y Area","Y Area":"Y Area",d3_y_line:"Y Line","Y Line":"Y Line",d3_xy_line:"X/Y Line","X/Y Line":"X/Y Line",d3_y_scatter:"Y Scatter","Y Scatter":"Y Scatter",d3_xy_scatter:"X/Y Scatter","X/Y Scatter":"X/Y Scatter",d3_x_bar:"X Bar","X Bar":"X Bar",d3_y_bar:"Y Bar","Y Bar":"Y Bar",d3_heatmap:"Heatmap",Heatmap:"Heatmap",d3_treemap:"Treemap",Treemap:"Treemap",d3_sunburst:"Sunburst",Sunburst:"Sunburst"};return"plugin"in e&&e.plugin!==r[e.plugin]&&(e.plugin=r[e.plugin],t.warn&&console.warn(`Deprecated perspective "plugin" attribute value "${e.plugin}" updated to "${r[e.plugin]}"`)),e}function Y(e,t){if(e.plugin==="Datagrid"&&!!e.plugin_config){if(!e.plugin_config.columns){t.warn&&console.warn('Deprecated perspective attribute "plugin_config" moved to "plugin_config.columns"');let r={};for(let i of Object.keys(e.plugin_config)){let n=e.plugin_config[i];delete e.plugin_config[i],typeof n.color_mode=="string"&&(n.color_mode==="foreground"?n.number_fg_mode="color":n.color_mode==="bar"?n.number_fg_mode="bar":n.color_mode==="background"?n.number_bg_mode="color":n.color_mode==="gradient"?n.number_bg_mode="gradient":console.warn(`Unknown color_mode ${n.color_mode}`),delete n.color_mode,t.warn&&console.warn('Deprecated perspective attribute "color_mode" renamed "number_bg_mode"')),r[i]=n}e.plugin_config.columns=r,t.replace_defaults&&(e.plugin_config.editable=!1,e.plugin_config.scroll_lock=!0)}for(let r of Object.keys(e.plugin_config.columns)){let i=e.plugin_config.columns[r];typeof i.number_color_mode=="string"&&(i.number_color_mode==="foreground"?i.number_fg_mode="color":i.number_color_mode==="bar"?i.number_fg_mode="bar":i.number_color_mode==="background"?i.number_bg_mode="color":i.number_color_mode==="gradient"&&(i.number_bg_mode="gradient"),delete i.number_color_mode,t.warn&&console.warn('Deprecated perspective attribute "number_color_mode" renamed "number_bg_mode"')),i.gradient!==void 0&&(i.number_bg_mode==="gradient"?i.bg_gradient=i.gradient:i.number_fg_mode==="bar"&&(i.fg_gradient=i.gradient),delete i.gradient,t.warn&&console.warn('Deprecated perspective attribute "gradient" renamed "bg_gradient"')),i.pos_color!==void 0&&(i.number_bg_mode!==void 0?i.pos_bg_color=i.pos_color:i.number_fg_mode!==void 0&&(i.pos_fg_color=i.pos_color),delete i.pos_color,t.warn&&console.warn('Deprecated perspective attribute "pos_color" renamed "pos_bg_color"')),i.neg_color!==void 0&&(i.number_bg_mode!==void 0?i.neg_bg_color=i.neg_color:i.number_fg_mode!==void 0&&(i.neg_fg_color=i.neg_color),delete i.neg_color,t.warn&&console.warn('Deprecated perspective attribute "neg_color" renamed "neg_bg_color"'))}}return e}function B(e,t){let r=["editable","selectable","name","table","master","linked"];for(let i of r)i in e&&(delete e[i],t.warn&&console.warn(`Deprecated perspective attribute "${i}" removed`));return e}function R(e,t){let r=["editable","selectable","name","table","master","linked"];for(let i of r)i in e&&e[i]===null&&(delete e[i],t.warn&&console.warn(`Deprecated perspective attribute "${i}" removed`));return e}import{PerspectiveNumberColumnStyleElement as O}from"@finos/perspective-viewer/dist/pkg/perspective_viewer.js";var w=class extends HTMLElement{constructor(){super()}async open(t,r,i){this.instance?this.instance.reset(r,i):this.instance=new O(this,r,i),this.instance.open(t)}destroy(){this.instance.destroy()}};document.createElement("perspective-number-column-style").constructor===HTMLElement&&window.customElements.define("perspective-number-column-style",w);import{PerspectiveStringColumnStyleElement as U}from"@finos/perspective-viewer/dist/pkg/perspective_viewer.js";var v=class extends HTMLElement{constructor(){super()}async open(t,r,i){this.instance?this.instance.reset(r):this.instance=new U(this,r,i),this.instance.open(t)}destroy(){this.instance.destroy()}};document.createElement("perspective-string-column-style").constructor===HTMLElement&&window.customElements.define("perspective-string-column-style",v);import{ExportDropDownMenuElement as X}from"@finos/perspective-viewer/dist/pkg/perspective_viewer.js";var b=class extends HTMLElement{constructor(){super();this.instance=new X(this)}open(t){this.instance.open(t)}unsafe_set_model(t){this.instance.unsafe_set_model(t)}};document.createElement("perspective-export-menu").constructor===HTMLElement&&window.customElements.define("perspective-export-menu",b);import{CopyDropDownMenuElement as N}from"@finos/perspective-viewer/dist/pkg/perspective_viewer.js";var y=class extends HTMLElement{constructor(){super();this.instance=new N(this)}open(t){this.instance.open(t)}unsafe_set_model(t){this.instance.unsafe_set_model(t)}};document.createElement("perspective-copy-menu").constructor===HTMLElement&&window.customElements.define("perspective-copy-menu",y);import"mobile-drag-drop-shadow-dom";var _e={HTMLPerspectiveViewerElement:p,HTMLPerspectiveViewerPluginElement:c};export{p as HTMLPerspectiveViewerElement,c as HTMLPerspectiveViewerPluginElement,Z as convert,_e as default};
//# sourceMappingURL=perspective-viewer.js.map
