var u=Object.defineProperty;var _=e=>u(e,"__esModule",{value:!0});var p=(e,n)=>{_(e);for(var t in n)u(e,t,{get:n[t],enumerable:!0})};p(exports,{convert:()=>l});function l(e,{warn:n=!0,replace_defaults:t=!1}={}){if(typeof e=="object"&&!(e instanceof ArrayBuffer)){let r=JSON.parse(JSON.stringify(e));return"viewers"in r&&"detail"in r?g(r,{warn:n,replace_defaults:t}):f(r,!1,{warn:n,replace_defaults:t})}else return e}function g(e,n){for(let t in e.viewers)e.viewers[t]=f(e.viewers[t],!0,n),"master"in e.viewers[t]||(e.viewers[t].master=!1,n.warn&&console.warn('Deprecated perspective missing attribute "master" set to default')),"linked"in e.viewers[t]||(e.viewers[t].linked=!1,n.warn&&console.warn('Deprecated perspective missing attribute "linked" set to default'));return e}function f(e,n,t){return m(e,[d,w,v,k,t.replace_defaults?b:!1,D,$,n?S:Y].filter(r=>!!r),t)}function m(e,n,t){for(let r of n)e=r(e,t);return e}function b(e,n){for(let t of["group_by","split_by","filter","sort"])e[t]===null&&(e[t]=[],n.warn&&console.warn(`Deprecated perspective missing attribute "${t}" set to default"`)),"aggregates"in e&&e.aggregates===null&&(e.aggregates={},n.warn&&console.warn('Deprecated perspective missing attribute "aggregates" set to default"'));return e}function c(e,n){return function(t,r){let i=0;for(let o of n)if(o in t){if(i++>0)throw new Error(`Duplicate "${e}" fields`);t[e]=t[o],o!==e&&(delete t[o],r.warn&&console.warn(`Deprecated perspective attribute "${o}" renamed "${e}"`))}return t}}var d=c("group_by",["group_by","row_pivots","row-pivot","row-pivots","row_pivot"]),w=c("split_by",["split_by","column_pivots","column-pivot","column-pivots","column_pivot","col_pivots","col-pivot","col-pivots","col_pivot"]),v=c("filter",["filter","filters"]);function y(e,n,t,r,i){if(e.test(t)){let o=t.replace(e,n);i.warn&&console.warn(`Deprecated perspective "expression" attribute value "${t}" updated to "${o}"`);for(let a of["group_by","split_by"])if(a in r)for(let s in r[a])r[a][s]===t.replace(/"/g,"")&&(r[a][s]=o,i.warn&&console.warn(`Deprecated perspective expression in "${a}" attribute "${t}" replaced with "${o}"`));for(let a of r.filter||[])a[0]===t.replace(/"/g,"")&&(a[0]=o,i.warn&&console.warn(`Deprecated perspective expression in "filter" attribute "${t}" replaced with "${o}"`));for(let a of r.sort||[])a[0]===t.replace(/"/g,"")&&(a[0]=o,i.warn&&console.warn(`Deprecated perspective expression in "sort" attribute "${t}" replaced with "${o}"`));return o}else return t}function k(e,n){if(e["computed-columns"]){if("expressions"in e)throw new Error('Duplicate "expressions" and "computed-columns');e.expressions=e["computed-columns"],delete e["computed-columns"],n.warn&&console.warn('Deprecated perspective attribute "computed-columns" renamed "expressions"');let t=[[/^year_bucket\("(.+?)"\)/,`bucket("$1", 'y')`],[/^month_bucket\("(.+?)"\)/,`bucket("$1", 'M')`],[/^day_bucket\("(.+?)"\)/,`bucket("$1", 'd')`],[/^hour_bucket\("(.+?)"\)/,`bucket("$1", 'h')`],[/^minute_bucket\("(.+?)"\)/,`bucket("$1", 'm')`],[/^second_bucket\("(.+?)"\)/,`bucket("$1", 's')`]];for(let r in e.expressions){let i=e.expressions[r];for(let[o,a]of t)i=y(o,a,i,e,n);e.expressions[r]=i}}return e}function D(e,n){let t={datagrid:"Datagrid",Datagrid:"Datagrid",d3_y_area:"Y Area","Y Area":"Y Area",d3_y_line:"Y Line","Y Line":"Y Line",d3_xy_line:"X/Y Line","X/Y Line":"X/Y Line",d3_y_scatter:"Y Scatter","Y Scatter":"Y Scatter",d3_xy_scatter:"X/Y Scatter","X/Y Scatter":"X/Y Scatter",d3_x_bar:"X Bar","X Bar":"X Bar",d3_y_bar:"Y Bar","Y Bar":"Y Bar",d3_heatmap:"Heatmap",Heatmap:"Heatmap",d3_treemap:"Treemap",Treemap:"Treemap",d3_sunburst:"Sunburst",Sunburst:"Sunburst"};return"plugin"in e&&e.plugin!==t[e.plugin]&&(e.plugin=t[e.plugin],n.warn&&console.warn(`Deprecated perspective "plugin" attribute value "${e.plugin}" updated to "${t[e.plugin]}"`)),e}function $(e,n){if(e.plugin==="Datagrid"&&!!e.plugin_config){if(!e.plugin_config.columns){n.warn&&console.warn('Deprecated perspective attribute "plugin_config" moved to "plugin_config.columns"');let t={};for(let r of Object.keys(e.plugin_config)){let i=e.plugin_config[r];delete e.plugin_config[r],typeof i.color_mode=="string"&&(i.color_mode==="foreground"?i.number_fg_mode="color":i.color_mode==="bar"?i.number_fg_mode="bar":i.color_mode==="background"?i.number_bg_mode="color":i.color_mode==="gradient"?i.number_bg_mode="gradient":console.warn(`Unknown color_mode ${i.color_mode}`),delete i.color_mode,n.warn&&console.warn('Deprecated perspective attribute "color_mode" renamed "number_bg_mode"')),t[r]=i}e.plugin_config.columns=t,n.replace_defaults&&(e.plugin_config.editable=!1,e.plugin_config.scroll_lock=!0)}for(let t of Object.keys(e.plugin_config.columns)){let r=e.plugin_config.columns[t];typeof r.number_color_mode=="string"&&(r.number_color_mode==="foreground"?r.number_fg_mode="color":r.number_color_mode==="bar"?r.number_fg_mode="bar":r.number_color_mode==="background"?r.number_bg_mode="color":r.number_color_mode==="gradient"&&(r.number_bg_mode="gradient"),delete r.number_color_mode,n.warn&&console.warn('Deprecated perspective attribute "number_color_mode" renamed "number_bg_mode"')),r.gradient!==void 0&&(r.number_bg_mode==="gradient"?r.bg_gradient=r.gradient:r.number_fg_mode==="bar"&&(r.fg_gradient=r.gradient),delete r.gradient,n.warn&&console.warn('Deprecated perspective attribute "gradient" renamed "bg_gradient"')),r.pos_color!==void 0&&(r.number_bg_mode!==void 0?r.pos_bg_color=r.pos_color:r.number_fg_mode!==void 0&&(r.pos_fg_color=r.pos_color),delete r.pos_color,n.warn&&console.warn('Deprecated perspective attribute "pos_color" renamed "pos_bg_color"')),r.neg_color!==void 0&&(r.number_bg_mode!==void 0?r.neg_bg_color=r.neg_color:r.number_fg_mode!==void 0&&(r.neg_fg_color=r.neg_color),delete r.neg_color,n.warn&&console.warn('Deprecated perspective attribute "neg_color" renamed "neg_bg_color"'))}}return e}function Y(e,n){let t=["editable","selectable","name","table","master","linked"];for(let r of t)r in e&&(delete e[r],n.warn&&console.warn(`Deprecated perspective attribute "${r}" removed`));return e}function S(e,n){let t=["editable","selectable","name","table","master","linked"];for(let r of t)r in e&&e[r]===null&&(delete e[r],n.warn&&console.warn(`Deprecated perspective attribute "${r}" removed`));return e}
//# sourceMappingURL=migrate.js.map
